{"comments":[{"id":"IC_kwDOQsqSJc7cPUS9","author":{"login":"codeant-ai"},"authorAssociation":"NONE","body":"CodeAnt AI is reviewing your PR.\n\n---\n\n### Thanks for using CodeAnt! üéâ\n\nWe're free for open-source projects. if you're enjoying it, help us grow by sharing.\n\n[Share on X](https://twitter.com/intent/tweet?text=Just%20tried%20%40CodeAntAI%20for%20automated%20code%20review%20and%20I%27m%20impressed%21%20Free%20for%20open%20source%20with%20a%20free%20trial%20for%20private%20repos.%20Worth%20checking%20out%3A&url=https%3A//codeant.ai) ¬∑\n[Reddit](https://www.reddit.com/submit?title=Check%20out%20CodeAnt%20for%20automated%20code%20review&text=Just%20tried%20CodeAnt%20for%20automated%20code%20review%20and%20I%27m%20impressed%21%20Free%20for%20open%20source%20with%20a%20free%20trial%20for%20private%20repos.%20Worth%20checking%20out%3A%20https%3A//codeant.ai) ¬∑\n[LinkedIn](https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fcodeant.ai&mini=true&title=Check%20out%20CodeAnt%20for%20automated%20code%20review&summary=Just%20tried%20CodeAnt%20for%20automated%20code%20review%20and%20I%27m%20impressed%21%20Free%20for%20open%20source%20with%20a%20free%20trial%20for%20private%20repos)\n","createdAt":"2025-12-28T19:59:20Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/shipdocs/bastion-firewall/pull/19#issuecomment-3695002813","viewerDidAuthor":false},{"id":"IC_kwDOQsqSJc7cPUTj","author":{"login":"coderabbitai"},"authorAssociation":"CONTRIBUTOR","body":"<!-- This is an auto-generated comment: summarize by coderabbit.ai -->\n<!-- walkthrough_start -->\n\n<details>\n<summary>üìù Walkthrough</summary>\n\n## Walkthrough\n\nAdds a Rust-based bastion-daemon with eBPF kernel hooks, a new IPC and rules subsystem, eBPF loader and process-identification logic, updated packaging and systemd units, non-modal 60s GUI dialogs with decision_id, helper scripts for privileged updates, and extensive docs, build and install tooling for v2.0.\n\n## Changes\n\n| Cohort / File(s) | Summary |\n|---|---|\n| **Documentation** <br> `README.md`, `REQUIREMENTS.md`, `TESTING.md`, `CLAUDE.md`, `.github-issue-popup-focus.md`, `bastion-rs/README.md`, `index.html` | New and expanded docs: architecture, requirements, testing, developer guidance, and issue write-up emphasizing Rust daemon + eBPF. |\n| **Rust Project & Build** <br> `bastion-rs/Cargo.toml`, `bastion-rs/ebpf/Cargo.toml`, `bastion-rs/build_ebpf.sh`, `bastion-rs/README.md`, `bastion-rs/.gitignore`, `bastion-rs/start_daemon.sh`, `bastion-rs/src/*` | New Rust crate and eBPF target with build scripts; added modules: main daemon, config, ebpf_loader, ipc, process, rules, whitelist; manifests and build helpers. |\n| **eBPF Program** <br> `bastion-rs/ebpf/src/main.rs` | New no_std eBPF program with kprobes (tcp_v4_connect, udp_sendmsg) populating SOCKET_MAP (SocketKey/SocketInfo). |\n| **Daemon Logic & IPC** <br> `bastion-rs/src/main.rs`, `bastion-rs/src/ebpf_loader.rs`, `bastion-rs/src/ipc.rs` | NFQUEUE processing, process lookup via eBPF+/proc fallback, GuiState and Unix socket IPC server, stats reporting, SIGHUP reload handling. |\n| **Process Mapping & Rules** <br> `bastion-rs/src/process.rs`, `bastion-rs/src/rules.rs`, `bastion-rs/src/config.rs`, `bastion-rs/src/whitelist.rs` | ProcessCache with /proc parsing and eBPF fallback, RuleManager (JSON persistence), ConfigManager (learning/enforcement flags), whitelist heuristics. |\n| **Python GUI & Integration** <br> `bastion-gui.py`, `bastion/gui_qt.py` | Non-modal 60s FirewallDialog (show, finished signal), decision_id propagation, replaced privileged file moves with helper scripts, closeEvent to ignore accidental closes. |\n| **Legacy Python Daemon & Firewall Core** <br> `bastion/daemon.py`, `bastion/firewall_core.py` | Startup wrapped with try/finally cleanup; NFQUEUE rules now use `--queue-bypass`. |\n| **Systemd & Service Unit** <br> `bastion-firewall.service` | Service switched to `simple`, direct ExecStart to `bastion-daemon`, added ExecStartPre/ExecStopPost for iptables, capability and journal redirection changes. |\n| **Packaging & Debian Scripts** <br> `build_deb.sh`, `build_deb_v2.sh`, `debian/DEBIAN/control`, `debian/DEBIAN/postinst`, `debian/DEBIAN/preinst` | Package version bump to 2.0.0, architecture ‚Üí amd64, updated dependencies, packaging now bundles Rust daemon and eBPF, modified install scripts and postinst/preinst flows. |\n| **Install / Uninstall / Helpers** <br> `install.sh`, `install_rust_daemon.sh`, `uninstall.sh`, `bastion-launch-gui.sh`, `bastion-reload-config`, `bastion-reload-rules`, `start_daemon.sh` | New installers, uninstaller, GUI launcher for active sessions, and privileged helpers to atomically move files, set perms, and signal daemon. |\n| **Desktop & UI Assets** <br> `bastion-tray.desktop`, `debian/usr/lib/python3/dist-packages/bastion/__main__.py`, `index.html` | Desktop entry metadata adjusted (visible autostart, delay), new Python module entrypoint added to packaging layout, website feature text updated. |\n| **Miscellaneous** <br> `.gitignore`, `bastion-rs/.gitignore`, `CLAUDE.md`, `TESTING.md` | Gitignore updates for target/ and logs; assorted contributing/doc files added. |\n\n## Sequence Diagram(s)\n\n```mermaid\nsequenceDiagram\n    participant App as Application\n    participant Kernel as Kernel (eBPF)\n    participant NFQ as Netfilter (NFQUEUE)\n    participant Daemon as Rust Daemon\n    participant IPC as Unix Socket IPC\n    participant GUI as Python GUI\n    participant Rules as RuleManager\n\n    App->>Kernel: tcp_v4_connect / udp_sendmsg\n    activate Kernel\n    Kernel->>Kernel: Kprobe -> populate SOCKET_MAP (pid,dst)\n    Kernel-->>NFQ: Packet queued to NFQUEUE\n    deactivate Kernel\n\n    NFQ->>Daemon: deliver packet\n    activate Daemon\n    Daemon->>Daemon: parse packet & lookup_pid()\n    Daemon->>Kernel: query SOCKET_MAP (ebpf) / fallback to /proc\n    Daemon->>Rules: get_decision(app_path, port)\n    alt rule exists\n        Rules-->>Daemon: allow/block\n    else\n        Daemon->>IPC: ask_gui(ConnectionRequest)\n        IPC-->>GUI: send request\n        GUI->>GUI: show() non-modal dialog (60s)\n        GUI-->>IPC: JSON response {allow, permanent, decision_id}\n        IPC-->>Daemon: deliver response\n        alt permanent\n            Daemon->>Rules: add_rule(...)\n        end\n    end\n    Daemon->>NFQ: Verdict (ACCEPT/DROP)\n    deactivate Daemon\n```\n\n```mermaid\nsequenceDiagram\n    participant Admin as Admin\n    participant Helper as bastion-reload-rules\n    participant RulesFile as /etc/bastion/rules.json\n    participant Daemon as Rust Daemon\n\n    Admin->>Helper: run helper with temp + target\n    activate Helper\n    Helper->>Helper: validate temp, ensure target under /etc/bastion\n    Helper->>RulesFile: move temp -> rules.json\n    Helper->>RulesFile: chmod 644\n    Helper->>Daemon: pkill -HUP bastion-daemon\n    Daemon->>Daemon: reload rules on SIGHUP\n    Helper-->>Admin: exit 0\n    deactivate Helper\n```\n\n## Estimated code review effort\n\nüéØ 5 (Critical) | ‚è±Ô∏è ~90 minutes\n\n## Possibly related PRs\n\n- shipdocs/bastion-firewall#2 ‚Äî related changes to daemon startup/entrypoint and migration from prior Python startup logic.\n(Only PRs with strong code-level relation were included.)\n\n## Suggested labels\n\n`codex`, `Review effort 2/5`, `size:M`\n\n> \"üêá From userspace to kernel light,  \n> small hops, big teeth, I watch the byte.  \n> Dialogs that wait, rules that stay,  \n> eBPF tracks the sneakiest play.  \n> V2.0 blooms ‚Äî I nibble and cheer!\"\n\n</details>\n\n<!-- walkthrough_end -->\n\n\n<!-- pre_merge_checks_walkthrough_start -->\n\n## Pre-merge checks and finishing touches\n<details>\n<summary>‚ùå Failed checks (1 inconclusive)</summary>\n\n|  Check name | Status         | Explanation                                                                                                                                                                                                            | Resolution                                                                                                                                                                  |\n| :---------: | :------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |\n| Title check | ‚ùì Inconclusive | The title 'Feature/rust daemon v3 final' is vague and does not clearly convey the primary change; it uses generic convention-style phrasing ('Feature/') without describing what the rust daemon feature accomplishes. | Consider a more specific title like 'Replace Python daemon with Rust daemon v2.0 and eBPF' to clearly communicate the main change to reviewers scanning the commit history. |\n\n</details>\n<details>\n<summary>‚úÖ Passed checks (2 passed)</summary>\n\n|     Check name     | Status   | Explanation                                                                          |\n| :----------------: | :------- | :----------------------------------------------------------------------------------- |\n|  Description Check | ‚úÖ Passed | Check skipped - CodeRabbit‚Äôs high-level summary is enabled.                          |\n| Docstring Coverage | ‚úÖ Passed | Docstring coverage is 100.00% which is sufficient. The required threshold is 80.00%. |\n\n</details>\n\n<!-- pre_merge_checks_walkthrough_end -->\n\n<!-- finishing_touch_checkbox_start -->\n\n<details>\n<summary>‚ú® Finishing touches</summary>\n\n<details>\n<summary>üß™ Generate unit tests (beta)</summary>\n\n- [ ] <!-- {\"checkboxId\": \"f47ac10b-58cc-4372-a567-0e02b2c3d479\", \"radioGroupId\": \"utg-output-choice-group-unknown_comment_id\"} -->   Create PR with unit tests\n- [ ] <!-- {\"checkboxId\": \"07f1e7d6-8a8e-4e23-9900-8731c2c87f58\", \"radioGroupId\": \"utg-output-choice-group-unknown_comment_id\"} -->   Post copyable unit tests in a comment\n- [ ] <!-- {\"checkboxId\": \"6ba7b810-9dad-11d1-80b4-00c04fd430c8\", \"radioGroupId\": \"utg-output-choice-group-unknown_comment_id\"} -->   Commit unit tests in branch `feature/rust-daemon-v3-final`\n\n</details>\n\n</details>\n\n<!-- finishing_touch_checkbox_end -->\n\n<!-- tips_start -->\n\n---\n\nThanks for using [CodeRabbit](https://coderabbit.ai?utm_source=oss&utm_medium=github&utm_campaign=shipdocs/bastion-firewall&utm_content=19)! It's free for OSS, and your support helps us grow. If you like it, consider giving us a shout-out.\n\n<details>\n<summary>‚ù§Ô∏è Share</summary>\n\n- [X](https://twitter.com/intent/tweet?text=I%20just%20used%20%40coderabbitai%20for%20my%20code%20review%2C%20and%20it%27s%20fantastic%21%20It%27s%20free%20for%20OSS%20and%20offers%20a%20free%20trial%20for%20the%20proprietary%20code.%20Check%20it%20out%3A&url=https%3A//coderabbit.ai)\n- [Mastodon](https://mastodon.social/share?text=I%20just%20used%20%40coderabbitai%20for%20my%20code%20review%2C%20and%20it%27s%20fantastic%21%20It%27s%20free%20for%20OSS%20and%20offers%20a%20free%20trial%20for%20the%20proprietary%20code.%20Check%20it%20out%3A%20https%3A%2F%2Fcoderabbit.ai)\n- [Reddit](https://www.reddit.com/submit?title=Great%20tool%20for%20code%20review%20-%20CodeRabbit&text=I%20just%20used%20CodeRabbit%20for%20my%20code%20review%2C%20and%20it%27s%20fantastic%21%20It%27s%20free%20for%20OSS%20and%20offers%20a%20free%20trial%20for%20proprietary%20code.%20Check%20it%20out%3A%20https%3A//coderabbit.ai)\n- [LinkedIn](https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fcoderabbit.ai&mini=true&title=Great%20tool%20for%20code%20review%20-%20CodeRabbit&summary=I%20just%20used%20CodeRabbit%20for%20my%20code%20review%2C%20and%20it%27s%20fantastic%21%20It%27s%20free%20for%20OSS%20and%20offers%20a%20free%20trial%20for%20proprietary%20code)\n\n</details>\n\n<sub>Comment `@coderabbitai help` to get the list of available commands and usage tips.</sub>\n\n<!-- tips_end -->\n\n<!-- internal state start -->\n\n\n<!-- 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 -->\n\n<!-- internal state end -->","createdAt":"2025-12-28T19:59:26Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/shipdocs/bastion-firewall/pull/19#issuecomment-3695002851","viewerDidAuthor":false},{"id":"IC_kwDOQsqSJc7cPUdF","author":{"login":"qodo-code-review"},"authorAssociation":"CONTRIBUTOR","body":"## PR Compliance Guide üîç\n\n\n<!-- https://github.com/shipdocs/bastion-firewall/commit/7a0a121e4125e8c88be928e44bceb615a10f90cb -->\n#### (Compliance updated until commit https://github.com/shipdocs/bastion-firewall/commit/7a0a121e4125e8c88be928e44bceb615a10f90cb)\nBelow is a summary of compliance checks for this PR:<br>\n<table><tbody><tr><td colspan='2'><strong>Security Compliance</strong></td></tr>\n<tr><td rowspan=2>üî¥</td>\n<td><details><summary><strong>Privilege boundary bypass\n</strong></summary><br>\n\n<b>Description:</b> The post-install script automatically adds all ‚Äúdesktop users‚Äù (UID >= 1000) to the <br><code>bastion</code> group, which (together with the daemon‚Äôs group-readable socket permissions) grants <br>unprivileged local users access to the firewall control plane and can allow them to <br>influence allow/deny decisions and rules without explicit authorization.<br> <strong><a href='https://github.com/shipdocs/bastion-firewall/pull/19/files#diff-56983614e0655f2f9c1f681d3b71f0c2727500bbb08631a90126b6c0f4f29e78R12-R29'>postinst [12-29]</a></strong><br>\n\n<details open><summary>Referred Code</summary>\n\n```txt\n# Add all desktop users to bastion group (UID >= 1000, excluding system accounts)\necho \"Adding desktop users to bastion group...\"\nADDED_USERS=\"\"\ngetent passwd | awk -F: '$3 >= 1000 && $3 < 65534 {print $1}' | while read username; do\n    # Skip nobody and other special accounts\n    if [ \"$username\" = \"nobody\" ]; then\n        continue\n    fi\n\n    # Add user to bastion group if not already a member\n    if ! groups \"$username\" 2>/dev/null | grep -q bastion; then\n        usermod -a -G bastion \"$username\" 2>/dev/null && echo \"  ‚úì Added $username to bastion group\"\n    fi\ndone\n\necho \"Desktop users have been added to bastion group.\"\necho \"Note: Users must log out and back in for group membership to take effect.\"\n\n```\n\n</details></details></td></tr>\n<tr><td><details><summary><strong>Unauthenticated IPC control\n</strong></summary><br>\n\n<b>Description:</b> The Rust daemon accepts any process that can connect to the Unix socket at <code>SOCKET_PATH</code> and <br>trusts any JSON response it sends (no peer-credential verification, authentication, or <br>request/response binding), allowing any local client with socket access to spoof GUI <br>decisions and potentially alter firewall behavior.<br> <strong><a href='https://github.com/shipdocs/bastion-firewall/pull/19/files#diff-8155b3e9f214baacbf16aadb39c6bbc9a913e8ef313ff1f48849fd9018ce4c34R402-R452'>main.rs [402-452]</a></strong><br>\n\n<details open><summary>Referred Code</summary>\n\n```rust\nfn run_socket_server(gui_state: Arc<Mutex<GuiState>>) {\n    // FIX #26: Handle missing parent directory gracefully\n    // Create socket directory\n    let socket_path = std::path::Path::new(SOCKET_PATH);\n    let socket_dir = match socket_path.parent() {\n        Some(dir) => dir,\n        None => {\n            error!(\"Socket path has no parent directory: {}\", SOCKET_PATH);\n            return;\n        }\n    };\n    std::fs::create_dir_all(socket_dir).ok();\n    let _ = std::fs::remove_file(SOCKET_PATH);\n\n    let listener = match UnixListener::bind(SOCKET_PATH) {\n        Ok(l) => l,\n        Err(e) => {\n            error!(\"Failed to bind socket: {}\", e);\n            return;\n        }\n    };\n\n\n ... (clipped 30 lines)\n```\n\n</details></details></td></tr>\n<tr><td colspan='2'><strong>Ticket Compliance</strong></td></tr>\n<tr><td>‚ö™</td><td><details><summary>üé´ <strong>No ticket provided </strong></summary>\n\n\n- [ ] Create ticket/issue <!-- /create_ticket --create_ticket=true -->\n\n</details></td></tr>\n<tr><td colspan='2'><strong>Codebase Duplication Compliance</strong></td></tr>\n<tr><td>‚ö™</td><td><details><summary><strong>Codebase context is not defined </strong></summary>\n\n\nFollow the <a href='https://qodo-merge-docs.qodo.ai/core-abilities/rag_context_enrichment/'>guide</a> to enable codebase context checks.\n\n</details></td></tr>\n<tr><td colspan='2'><strong>Custom Compliance</strong></td></tr>\n<tr><td rowspan=1>üü¢</td><td>\n<details><summary><strong>Generic: Meaningful Naming and Self-Documenting Code</strong></summary><br>\n\n**Objective:** Ensure all identifiers clearly express their purpose and intent, making code <br>self-documenting<br>\n\n**Status:** Passed<br>\n\n\n> Learn more about managing compliance <a href='https://qodo-merge-docs.qodo.ai/tools/compliance/#configuration-options'>generic rules</a> or creating your own <a href='https://qodo-merge-docs.qodo.ai/tools/compliance/#custom-compliance'>custom rules</a>\n</details></td></tr>\n<tr><td rowspan=1>üî¥</td>\n<td><details>\n<summary><strong>Generic: Secure Error Handling</strong></summary><br>\n\n**Objective:** To prevent the leakage of sensitive system information through error messages while <br>providing sufficient detail for internal debugging.<br>\n\n**Status:** <br><a href='https://github.com/shipdocs/bastion-firewall/pull/19/files#diff-f9f219109b878859f078120342e6af5b34efa439fd52b2b3cec00b97cb0fe859R1109-R1119'><strong>Sensitive error shown</strong></a>: The GUI shows raw exception text to the user (e.g., <code>show_notification(..., f&quot;Failed </code><br><code>to save rules: {e}&quot;)</code>), which can leak internal paths/system details instead of a <br>generic user-facing error with details only in internal logs.<br>\n<details open><summary>Referred Code</summary>\n\n```python\n    with tempfile.NamedTemporaryFile(mode='w', delete=False) as tmp:\n        json.dump(self.data_rules, tmp, indent=2)\n        tmp_path = tmp.name\n\n    # Use single helper script to move, chmod, and signal daemon (only 1 password prompt)\n    if not self._run_privileged(['pkexec', '/usr/bin/bastion-reload-rules', tmp_path, str(self.rules_path)],\n                                error_hint=\"Failed to save rules.\"):\n        return\nexcept Exception as e:\n    from .notification import show_notification\n    show_notification(self, \"Error\", f\"Failed to save rules: {e}\")\n```\n\n</details>\n\n> Learn more about managing compliance <a href='https://qodo-merge-docs.qodo.ai/tools/compliance/#configuration-options'>generic rules</a> or creating your own <a href='https://qodo-merge-docs.qodo.ai/tools/compliance/#custom-compliance'>custom rules</a>\n</details></td></tr>\n<tr><td rowspan=4>‚ö™</td>\n\n<tr><td align=\"center\" colspan=\"2\">\n\n<!-- placeholder --> <!-- /compliance --update_compliance=true -->\n\n</td></tr></tbody></table>\n<details><summary>Compliance status legend</summary>\nüü¢ - Fully Compliant<br>\nüü° - Partial Compliant<br>\nüî¥ - Not Compliant<br>\n‚ö™ - Requires Further Human Verification<br>\nüè∑Ô∏è - Compliance label<br>\n</details>\n\n___\n\n#### Previous compliance checks\n\n<details>\n<summary>Compliance check up to commit <a href='https://github.com/shipdocs/bastion-firewall/commit/ab3c5d7aee2870bca07da253ba9109b05c5b16cf'>ab3c5d7</a></summary><br>\n<table><tbody><tr><td colspan='2'><strong>Security Compliance</strong></td></tr>\n<tr><td rowspan=1>üî¥</td>\n<td><details><summary><strong>Unauthenticated IPC socket\n</strong></summary><br>\n\n<b>Description:</b> The daemon exposes an unauthenticated Unix-domain control socket at <br><code>/var/run/bastion/bastion-daemon.sock</code> and explicitly sets permissions to <code>0o666</code>, allowing <br>any local user to connect and send forged GUI responses (e.g., always <code>{\"allow\": true, </code><br><code>\"permanent\": true}</code>) to influence firewall decisions made by a root-running daemon.<br> <strong><a href='https://github.com/shipdocs/bastion-firewall/pull/19/files#diff-8155b3e9f214baacbf16aadb39c6bbc9a913e8ef313ff1f48849fd9018ce4c34R402-R444'>main.rs [402-444]</a></strong><br>\n\n<details open><summary>Referred Code</summary>\n\n```rust\nfn run_socket_server(gui_state: Arc<Mutex<GuiState>>) {\n    // FIX #26: Handle missing parent directory gracefully\n    // Create socket directory\n    let socket_path = std::path::Path::new(SOCKET_PATH);\n    let socket_dir = match socket_path.parent() {\n        Some(dir) => dir,\n        None => {\n            error!(\"Socket path has no parent directory: {}\", SOCKET_PATH);\n            return;\n        }\n    };\n    std::fs::create_dir_all(socket_dir).ok();\n    let _ = std::fs::remove_file(SOCKET_PATH);\n\n    let listener = match UnixListener::bind(SOCKET_PATH) {\n        Ok(l) => l,\n        Err(e) => {\n            error!(\"Failed to bind socket: {}\", e);\n            return;\n        }\n    };\n\n\n ... (clipped 22 lines)\n```\n\n</details></details></td></tr>\n<tr><td colspan='2'><strong>Ticket Compliance</strong></td></tr>\n<tr><td>‚ö™</td><td><details><summary>üé´ <strong>No ticket provided </strong></summary>\n\n\n- [ ] Create ticket/issue <!-- /create_ticket --create_ticket=true -->\n\n</details></td></tr>\n<tr><td colspan='2'><strong>Codebase Duplication Compliance</strong></td></tr>\n<tr><td>‚ö™</td><td><details><summary><strong>Codebase context is not defined </strong></summary>\n\n\nFollow the <a href='https://qodo-merge-docs.qodo.ai/core-abilities/rag_context_enrichment/'>guide</a> to enable codebase context checks.\n\n</details></td></tr>\n<tr><td colspan='2'><strong>Custom Compliance</strong></td></tr>\n<tr><td rowspan=1>üü¢</td><td>\n<details><summary><strong>Generic: Meaningful Naming and Self-Documenting Code</strong></summary><br>\n\n**Objective:** Ensure all identifiers clearly express their purpose and intent, making code <br>self-documenting<br>\n\n**Status:** Passed<br>\n\n\n> Learn more about managing compliance <a href='https://qodo-merge-docs.qodo.ai/tools/compliance/#configuration-options'>generic rules</a> or creating your own <a href='https://qodo-merge-docs.qodo.ai/tools/compliance/#custom-compliance'>custom rules</a>\n</details></td></tr>\n<tr><td rowspan=4>üî¥</td>\n<td><details>\n<summary><strong>Generic: Robust Error Handling and Edge Case Management</strong></summary><br>\n\n**Objective:** Ensure comprehensive error handling that provides meaningful context and graceful <br>degradation<br>\n\n**Status:** <br><a href='https://github.com/shipdocs/bastion-firewall/pull/19/files#diff-187b1e5910f096aae7417e760f849b9a564ea1ed82afd7d450e58fa8cced9a57R261-R265'><strong>Bare exception</strong></a>: The new non-modal dialog response send uses a bare <code>except:</code> which can silently swallow <br>unexpected errors and loses actionable context for diagnosing failures.<br>\n<details open><summary>Referred Code</summary>\n\n```python\ntry:\n    self.sock.sendall(resp.encode())\nexcept:\n    self.handle_disconnect()\n\n```\n\n</details>\n\n> Learn more about managing compliance <a href='https://qodo-merge-docs.qodo.ai/tools/compliance/#configuration-options'>generic rules</a> or creating your own <a href='https://qodo-merge-docs.qodo.ai/tools/compliance/#custom-compliance'>custom rules</a>\n</details></td></tr>\n<tr><td><details>\n<summary><strong>Generic: Secure Error Handling</strong></summary><br>\n\n**Objective:** To prevent the leakage of sensitive system information through error messages while <br>providing sufficient detail for internal debugging.<br>\n\n**Status:** <br><a href='https://github.com/shipdocs/bastion-firewall/pull/19/files#diff-f9f219109b878859f078120342e6af5b34efa439fd52b2b3cec00b97cb0fe859R1117-R1119'><strong>Exception shown to user</strong></a>: User-facing notifications include the raw exception string (e.g., <code>Failed to save rules: </code><br><code>{e}</code>), which can leak internal paths/system details to end users.<br>\n<details open><summary>Referred Code</summary>\n\n```python\nexcept Exception as e:\n    from .notification import show_notification\n    show_notification(self, \"Error\", f\"Failed to save rules: {e}\")\n```\n\n</details>\n\n> Learn more about managing compliance <a href='https://qodo-merge-docs.qodo.ai/tools/compliance/#configuration-options'>generic rules</a> or creating your own <a href='https://qodo-merge-docs.qodo.ai/tools/compliance/#custom-compliance'>custom rules</a>\n</details></td></tr>\n<tr><td><details>\n<summary><strong>Generic: Secure Logging Practices</strong></summary><br>\n\n**Objective:** To ensure logs are useful for debugging and auditing without exposing sensitive <br>information like PII, PHI, or cardholder data.<br>\n\n**Status:** <br><a href='https://github.com/shipdocs/bastion-firewall/pull/19/files#diff-8155b3e9f214baacbf16aadb39c6bbc9a913e8ef313ff1f48849fd9018ce4c34R585-R605'><strong>Sensitive data in logs</strong></a>: New daemon logs include potentially sensitive local data such as full <code>app_path</code> and <br>per-user identifiers (<code>uid</code>), which may expose user information in logs.<br>\n<details open><summary>Referred Code</summary>\n\n```rust\n        return if response.allow {\n            info!(\"[USER:ALLOW] app=\\\"{}\\\" dst=\\\"{}:{}\\\" user={}\", app_name, dst_ip, dst_port, app_uid);\n            Verdict::Accept\n        } else {\n            info!(\"[USER:BLOCK] app=\\\"{}\\\" dst=\\\"{}:{}\\\" user={}\", app_name, dst_ip, dst_port, app_uid);\n            Verdict::Drop\n        };\n    }\n}\ndrop(gui);\n\n// No GUI or no response - use mode default\nif learning_mode {\n    info!(\"[LEARN] app=\\\"{}\\\" path=\\\"{}\\\" dst=\\\"{}:{}\\\" user={}\", app_name, app_path, dst_ip, dst_port, app_uid);\n    Verdict::Accept\n} else {\n    if app_path == \"unknown\" {\n        Verdict::Accept\n    } else {\n        warn!(\"[BLOCK] app=\\\"{}\\\" dst=\\\"{}:{}\\\" user={} (no GUI)\", app_name, dst_ip, dst_port, app_uid);\n        Verdict::Drop\n```\n\n</details>\n\n> Learn more about managing compliance <a href='https://qodo-merge-docs.qodo.ai/tools/compliance/#configuration-options'>generic rules</a> or creating your own <a href='https://qodo-merge-docs.qodo.ai/tools/compliance/#custom-compliance'>custom rules</a>\n</details></td></tr>\n<tr><td><details>\n<summary><strong>Generic: Security-First Input Validation and Data Handling</strong></summary><br>\n\n**Objective:** Ensure all data inputs are validated, sanitized, and handled securely to prevent <br>vulnerabilities<br>\n\n**Status:** <br><a href='https://github.com/shipdocs/bastion-firewall/pull/19/files#diff-8155b3e9f214baacbf16aadb39c6bbc9a913e8ef313ff1f48849fd9018ce4c34R424-R429'><strong>Unauthenticated local IPC</strong></a>: The Unix socket is made world-readable/writable (<code>0o666</code>) without <br>authentication/authorization, allowing any local user to send arbitrary GUI <br>responses/inputs to the daemon.<br>\n<details open><summary>Referred Code</summary>\n\n```rust\n#[cfg(unix)]\n{\n    use std::os::unix::fs::PermissionsExt;\n    // Allow all local users to connect to the socket\n    let _ = std::fs::set_permissions(SOCKET_PATH, std::fs::Permissions::from_mode(0o666));\n}\n```\n\n</details>\n\n> Learn more about managing compliance <a href='https://qodo-merge-docs.qodo.ai/tools/compliance/#configuration-options'>generic rules</a> or creating your own <a href='https://qodo-merge-docs.qodo.ai/tools/compliance/#custom-compliance'>custom rules</a>\n</details></td></tr>\n<tr><td rowspan=1>‚ö™</td>\n<td><details>\n<summary><strong>Generic: Comprehensive Audit Trails</strong></summary><br>\n\n**Objective:** To create a detailed and reliable record of critical system actions for security analysis <br>and compliance.<br>\n\n**Status:** <br><a href='https://github.com/shipdocs/bastion-firewall/pull/19/files#diff-f9f219109b878859f078120342e6af5b34efa439fd52b2b3cec00b97cb0fe859R1109-R1131'><strong>No audit logging</strong></a>: Privileged rule/config updates are executed via <code>pkexec</code> helper scripts without any explicit <br>audit log entry capturing actor identity, action details, and outcome in the new code <br>paths.<br>\n<details open><summary>Referred Code</summary>\n\n```python\n        with tempfile.NamedTemporaryFile(mode='w', delete=False) as tmp:\n            json.dump(self.data_rules, tmp, indent=2)\n            tmp_path = tmp.name\n\n        # Use single helper script to move, chmod, and signal daemon (only 1 password prompt)\n        if not self._run_privileged(['pkexec', '/usr/bin/bastion-reload-rules', tmp_path, str(self.rules_path)],\n                                    error_hint=\"Failed to save rules.\"):\n            return\n    except Exception as e:\n        from .notification import show_notification\n        show_notification(self, \"Error\", f\"Failed to save rules: {e}\")\n\ndef save_config(self):\n    self.data_config['mode'] = 'learning' if self.chk_learning.isChecked() else 'enforcement'\n    try:\n        with tempfile.NamedTemporaryFile(mode='w', delete=False) as tmp:\n            json.dump(self.data_config, tmp, indent=2)\n            tmp_path = tmp.name\n\n        # Use single helper script to move, chmod, and signal daemon (only 1 password prompt)\n        if not self._run_privileged(['pkexec', '/usr/bin/bastion-reload-config', tmp_path, str(self.config_path)],\n\n\n ... (clipped 2 lines)\n```\n\n</details>\n\n> Learn more about managing compliance <a href='https://qodo-merge-docs.qodo.ai/tools/compliance/#configuration-options'>generic rules</a> or creating your own <a href='https://qodo-merge-docs.qodo.ai/tools/compliance/#custom-compliance'>custom rules</a>\n</details></td></tr>\n\n<tr><td align=\"center\" colspan=\"2\">\n\n <!-- /compliance --update_compliance=true -->\n\n</td></tr></tbody></table>\n</details>\n","createdAt":"2025-12-28T20:00:19Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/shipdocs/bastion-firewall/pull/19#issuecomment-3695003461","viewerDidAuthor":false},{"id":"IC_kwDOQsqSJc7cPUqM","author":{"login":"qodo-code-review"},"authorAssociation":"CONTRIBUTOR","body":"## PR Code Suggestions ‚ú®\n<!-- 7a0a121 -->\n\nLatest suggestions up to 7a0a121\n<table><thead><tr><td><strong>Category</strong></td><td align=left><strong>Suggestion&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </strong></td><td align=center><strong>Impact</strong></td></tr><tbody><tr><td rowspan=5>Possible issue</td>\n<td>\n\n\n\n<details><summary>Allow GUI to connect</summary>\n\n___\n\n**Change the IPC socket's group to <code>bastion</code> and set its permissions to <code>0o660</code>. This <br>allows the GUI, running as a user in the <code>bastion</code> group, to connect to the <br>daemon's socket.**\n\n[bastion-rs/src/ipc.rs [108-112]](https://github.com/shipdocs/bastion-firewall/pull/19/files#diff-4c7599eee277596ba6fcfe58891e36682de025d205bf06cc30c04a69193d01d9R108-R112)\n\n```diff\n #[cfg(unix)]\n {\n     use std::os::unix::fs::PermissionsExt;\n-    let _ = std::fs::set_permissions(SOCKET_PATH, std::fs::Permissions::from_mode(0o600));\n+\n+    // Allow GUI users (in bastion group) to connect\n+    let _ = std::process::Command::new(\"chgrp\")\n+        .arg(\"bastion\")\n+        .arg(SOCKET_PATH)\n+        .status();\n+\n+    let _ = std::fs::set_permissions(SOCKET_PATH, std::fs::Permissions::from_mode(0o660));\n }\n```\n\n\n- [ ] **Apply / Chat** <!-- /improve --apply_suggestion=0 -->\n\n\n<details><summary>Suggestion importance[1-10]: 10</summary>\n\n__\n\nWhy: This suggestion fixes a critical bug where incorrect socket permissions (`0o600`) would prevent the user-space GUI from connecting to the root-owned daemon, rendering the entire application non-functional.\n\n\n</details></details></td><td align=center>High\n\n</td></tr><tr><td>\n\n\n\n<details><summary>Fix package filename mismatch</summary>\n\n___\n\n**Correct the hardcoded Debian package filename in <code>install.sh</code> to dynamically use <br>the system's architecture, fixing a mismatch with the build script that <br>prevented installation.**\n\n[install.sh [12-17]](https://github.com/shipdocs/bastion-firewall/pull/19/files#diff-043df5bdbf6639d7a77e1d44c5226fd7371e5259a1e4df3a0dd5d64c30dca44fR12-R17)\n\n```diff\n-DEB_FILE=\"bastion-firewall_2.0.0_all.deb\"\n+VERSION=\"2.0.0\"\n+ARCH=\"$(dpkg --print-architecture)\"\n+DEB_FILE=\"bastion-firewall_${VERSION}_${ARCH}.deb\"\n \n if [ ! -f \"$DEB_FILE\" ]; then\n     echo \"ERROR: $DEB_FILE not found in current directory\"\n+    echo \"Available packages:\"\n+    ls -1 \"bastion-firewall_${VERSION}_\"*.deb 2>/dev/null || true\n     exit 1\n fi\n```\n\n\n- [ ] **Apply / Chat** <!-- /improve --apply_suggestion=1 -->\n\n\n<details><summary>Suggestion importance[1-10]: 9</summary>\n\n__\n\nWhy: The suggestion fixes a critical bug where the `install.sh` script looks for a package with the wrong architecture (`_all.deb`) instead of the one produced by the build script (`_amd64.deb`), making installation fail.\n\n\n</details></details></td><td align=center>High\n\n</td></tr><tr><td>\n\n\n\n<details><summary>Make key layout padding explicit</summary>\n\n___\n\n**Add explicit padding fields to the <code>SocketKey</code> struct. This ensures a stable and <br>deterministic memory layout, preventing potential key mismatches between the <br>userspace daemon and the eBPF program.**\n\n[bastion-rs/src/ebpf_loader.rs [19-28]](https://github.com/shipdocs/bastion-firewall/pull/19/files#diff-e8428db524dc3ec7ede28ac53f192c94e09281022505aa28e5289ed836b939aeR19-R28)\n\n```diff\n #[derive(Debug, Clone, Copy)]\n #[repr(C)]\n pub struct SocketKey {\n     pub src_port: u16,\n+    pub _pad0: u16,   // explicit padding to keep layout stable/zeroed\n     pub dst_ip: u32,  // IPv4 in network byte order\n     pub dst_port: u16,\n+    pub _pad1: u16,   // align next u32\n     pub pid: u32,     // Disambiguator to prevent collisions between processes\n }\n \n unsafe impl Pod for SocketKey {}\n```\n\n\n- [ ] **Apply / Chat** <!-- /improve --apply_suggestion=2 -->\n\n\n<details><summary>Suggestion importance[1-10]: 9</summary>\n\n__\n\nWhy: This suggestion correctly identifies a critical and subtle bug where implicit, uninitialized padding in the `SocketKey` struct would lead to non-deterministic eBPF map lookups, potentially breaking the core process identification feature.\n\n\n</details></details></td><td align=center>High\n\n</td></tr><tr><td>\n\n\n\n<details><summary>Match signal-slot parameter signature</summary>\n\n___\n\n**Add an optional argument to the <code>on_dialog_finished</code> function to match the <br>signature of the <code>dialog.finished</code> signal, preventing a runtime crash.**\n\n[bastion-gui.py [250-268]](https://github.com/shipdocs/bastion-firewall/pull/19/files#diff-187b1e5910f096aae7417e760f849b9a564ea1ed82afd7d450e58fa8cced9a57R250-R268)\n\n```diff\n-def on_dialog_finished():\n+def on_dialog_finished(_result=None):\n     decision = (dialog.decision == 'allow')\n     permanent = dialog.permanent\n \n     # Send response with decision_id\n     if self.connected and self.sock:\n         resp = json.dumps({\n             'allow': decision,\n             'permanent': permanent,\n             'decision_id': decision_id\n         }) + '\\n'\n         try:\n             self.sock.sendall(resp.encode())\n         except (OSError, BrokenPipeError, ConnectionResetError):\n             self.handle_disconnect()\n \n     dialog.deleteLater()  # Clean up dialog\n \n dialog.finished.connect(on_dialog_finished)\n```\n\n\n- [ ] **Apply / Chat** <!-- /improve --apply_suggestion=3 -->\n\n\n<details><summary>Suggestion importance[1-10]: 8</summary>\n\n__\n\nWhy: The suggestion correctly identifies a signal-slot signature mismatch in Qt that would cause a runtime `TypeError` and crash the application, and the proposed fix is appropriate.\n\n\n</details></details></td><td align=center>Medium\n\n</td></tr><tr><td>\n\n\n\n<details><summary>Prevent NFQUEUE processing stalls</summary>\n\n___\n\n**Reduce the <code>GUI_TIMEOUT_SECS</code> constant to a smaller value to prevent the NFQUEUE <br>processing loop from blocking for too long, which can cause system-wide network <br>stalls.**\n\n[bastion-rs/src/main.rs [32]](https://github.com/shipdocs/bastion-firewall/pull/19/files#diff-8155b3e9f214baacbf16aadb39c6bbc9a913e8ef313ff1f48849fd9018ce4c34R32-R32)\n\n```diff\n-const GUI_TIMEOUT_SECS: u64 = 60;  // Increased to 60s to allow user to finish typing\n+// IMPORTANT: NFQUEUE processing must not block too long, or outbound networking can stall system-wide.\n+const GUI_TIMEOUT_SECS: u64 = 5;\n```\n\n\n- [ ] **Apply / Chat** <!-- /improve --apply_suggestion=4 -->\n\n\n<details><summary>Suggestion importance[1-10]: 8</summary>\n\n__\n\nWhy: The suggestion correctly identifies that a long GUI timeout will block the NFQUEUE processing loop, potentially causing system-wide network stalls for new connections, and proposes a reasonable fix.\n\n\n</details></details></td><td align=center>Medium\n\n</td></tr><tr><td rowspan=5>Incremental <sup><a href='https://qodo-merge-docs.qodo.ai/core-abilities/incremental_update/'>[*]</a></sup></td>\n<td>\n\n\n\n<details><summary>Add required eBPF capabilities</summary>\n\n___\n\n**Add <code>CAP_BPF</code> and <code>CAP_PERFMON</code> to the <code>CapabilityBoundingSet</code> and <code>AmbientCapabilities</code> <br>in the systemd service file to ensure the eBPF program can be loaded correctly.**\n\n[bastion-firewall.service [14-17]](https://github.com/shipdocs/bastion-firewall/pull/19/files#diff-e7fb5e23b406b2e65df33e223870991c4323949fa38b560fa624ac74f131e4e0R14-R17)\n\n```diff\n-CapabilityBoundingSet=CAP_NET_ADMIN CAP_NET_RAW\n-AmbientCapabilities=CAP_NET_ADMIN CAP_NET_RAW\n+CapabilityBoundingSet=CAP_NET_ADMIN CAP_NET_RAW CAP_BPF CAP_PERFMON\n+AmbientCapabilities=CAP_NET_ADMIN CAP_NET_RAW CAP_BPF CAP_PERFMON\n StandardOutput=journal\n StandardError=journal\n```\n\n\n- [ ] **Apply / Chat** <!-- /improve --apply_suggestion=5 -->\n\n\n<details><summary>Suggestion importance[1-10]: 9</summary>\n\n__\n\nWhy: This is a critical fix, as the eBPF functionality introduced in this PR requires `CAP_BPF` and `CAP_PERFMON` capabilities to load and attach programs on most systems, and their absence would cause the primary feature of this PR to fail.\n\n\n</details></details></td><td align=center>High\n\n</td></tr><tr><td>\n\n\n\n<details><summary>Restrict and validate destination path</summary>\n\n___\n\n**Harden the <code>bastion-reload-rules</code> script by restricting the <code>RULES_FILE</code> path to the <br><code>/etc/bastion/</code> directory and adding a check to ensure the destination is not a <br>symlink.**\n\n[bastion-reload-rules [27-31]](https://github.com/shipdocs/bastion-firewall/pull/19/files#diff-2d74c49518987e8487fe7795778d1eee184a28d5389f1c3dd2e48d798ea41af2R27-R31)\n\n```diff\n+# Ensure the rules file lives under the expected Bastion config directory\n+case \"$RULES_FILE\" in\n+    /etc/bastion/*) ;;\n+    *)\n+        echo \"Error: Invalid rules file path: $RULES_FILE\" >&2\n+        exit 1\n+        ;;\n+esac\n+\n # Reject symlinks to avoid clobbering arbitrary root-owned files\n if [ -L \"$TEMP_FILE\" ]; then\n     echo \"Error: Temporary file must not be a symlink: $TEMP_FILE\" >&2\n     exit 1\n fi\n+if [ -L \"$RULES_FILE\" ]; then\n+    echo \"Error: Rules file path must not be a symlink: $RULES_FILE\" >&2\n+    exit 1\n+fi\n```\n\n\n- [ ] **Apply / Chat** <!-- /improve --apply_suggestion=6 -->\n\n\n<details><summary>Suggestion importance[1-10]: 9</summary>\n\n__\n\nWhy: This is a critical security fix that addresses two vulnerabilities in a root-privileged script: it prevents arbitrary file writes by restricting the destination path and adds a check to block symlink attacks on the destination file.\n\n\n</details></details></td><td align=center>High\n\n</td></tr><tr><td>\n\n\n\n<details><summary>Select Qt platform per session</summary>\n\n___\n\n**Conditionally set the <code>QT_QPA_PLATFORM</code> environment variable based on the session <br>type (<code>wayland</code> or <code>x11</code>) to ensure the GUI launches correctly in both environments.**\n\n[bastion-launch-gui.sh [43-45]](https://github.com/shipdocs/bastion-firewall/pull/19/files#diff-f5c88428df02a75793d2429f5f9b8cb893cade30f44b37f82608a050b01448a9R43-R45)\n\n```diff\n+qt_platform=\"xcb\"\n+if [[ \"$session_type\" == \"wayland\" ]]; then\n+    qt_platform=\"wayland;xcb\"\n+fi\n systemd-run --user --machine=\"${session_user}@.host\" \\\n-            --setenv=QT_QPA_PLATFORM=wayland \\\n+            --setenv=QT_QPA_PLATFORM=\"$qt_platform\" \\\n             /usr/bin/bastion-gui\n```\n\n\n- [ ] **Apply / Chat** <!-- /improve --apply_suggestion=7 -->\n\n\n<details><summary>Suggestion importance[1-10]: 8</summary>\n\n__\n\nWhy: The suggestion correctly identifies a bug where hardcoding `QT_QPA_PLATFORM=wayland` will cause the GUI to fail on X11 sessions, preventing critical connection prompts from appearing.\n\n</details></details></td><td align=center>Medium\n\n</td></tr><tr><td>\n\n\n\n<details><summary>Block symlink-based file clobbering</summary>\n\n___\n\n**Add checks to the <code>bastion-reload-config</code> script to reject both the temporary file <br>and the config file if they are symbolic links, preventing potential security <br>vulnerabilities.**\n\n[bastion-reload-config [27-34]](https://github.com/shipdocs/bastion-firewall/pull/19/files#diff-67e8af6fb87ff1c8e72c7e6a5dc6f9f5fb0245674bdf14947e37d9bfff8e7edcR27-R34)\n\n```diff\n # Ensure the config file lives under the expected Bastion config directory\n case \"$CONFIG_FILE\" in\n-    /etc/bastion/*) ;;\n+    /etc/bastion/*)\n+        # Reject symlinks to avoid clobbering arbitrary root-owned files\n+        if [ -L \"$TEMP_FILE\" ]; then\n+            echo \"Error: Temporary file must not be a symlink: $TEMP_FILE\" >&2\n+            exit 1\n+        fi\n+        if [ -L \"$CONFIG_FILE\" ]; then\n+            echo \"Error: Config file path must not be a symlink: $CONFIG_FILE\" >&2\n+            exit 1\n+        fi\n+        ;;\n     *)\n         echo \"Error: Invalid config file path: $CONFIG_FILE\" >&2\n         exit 1\n         ;;\n esac\n```\n\n\n- [ ] **Apply / Chat** <!-- /improve --apply_suggestion=8 -->\n\n\n<details><summary>Suggestion importance[1-10]: 8</summary>\n\n__\n\nWhy: This is a valid security hardening suggestion for a root-privileged script, preventing potential file overwrites through symlink attacks on both the source and destination paths.\n\n\n</details></details></td><td align=center>Medium\n\n</td></tr><tr><td>\n\n\n\n<details><summary>Log socket ownership failures</summary>\n\n___\n\n**Add error handling for the <code>chgrp</code> command on the Unix socket to log any failures, <br>making it easier to diagnose GUI connection issues.**\n\n[bastion-rs/src/main.rs [433-436]](https://github.com/shipdocs/bastion-firewall/pull/19/files#diff-8155b3e9f214baacbf16aadb39c6bbc9a913e8ef313ff1f48849fd9018ce4c34R433-R436)\n\n```diff\n-let _ = Command::new(\"chgrp\")\n+match Command::new(\"chgrp\")\n     .arg(\"bastion\")\n     .arg(SOCKET_PATH)\n-    .output();\n+    .output()\n+{\n+    Ok(out) if out.status.success() => {}\n+    Ok(out) => {\n+        warn!(\n+            \"Failed to chgrp socket (exit={}): {}\",\n+            out.status,\n+            String::from_utf8_lossy(&out.stderr)\n+        );\n+    }\n+    Err(e) => warn!(\"Failed to execute chgrp for socket: {}\", e),\n+}\n```\n\n\n- [ ] **Apply / Chat** <!-- /improve --apply_suggestion=9 -->\n\n\n<details><summary>Suggestion importance[1-10]: 7</summary>\n\n__\n\nWhy: The suggestion correctly points out that silently ignoring a `chgrp` failure can make it difficult to diagnose why the GUI cannot connect, which is a critical function.\n\n</details></details></td><td align=center>Medium\n\n</td></tr>\n<tr><td align=\"center\" colspan=\"2\">\n\n- [ ] More <!-- /improve --more_suggestions=true -->\n\n</td><td></td></tr></tbody></table>\n\n___\n\n#### Previous suggestions\n<details><summary>Suggestions up to commit ab3c5d7</summary>\n<br><table><thead><tr><td><strong>Category</strong></td><td align=left><strong>Suggestion&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </strong></td><td align=center><strong>Impact</strong></td></tr><tbody><tr><td rowspan=4>Possible issue</td>\n<td>\n\n\n\n<details><summary>Fix IP endianness conversion</summary>\n\n___\n\n**Correct the IP address byte order conversion from native-endian (<code>from_ne_bytes</code>) <br>to big-endian (<code>from_be_bytes</code>) to ensure compatibility with the kernel's network <br>byte order expectation.**\n\n[bastion-rs/src/ebpf_loader.rs [161-164]](https://github.com/shipdocs/bastion-firewall/pull/19/files#diff-e8428db524dc3ec7ede28ac53f192c94e09281022505aa28e5289ed836b939aeR161-R164)\n\n```diff\n let dst_ip_u32: u32 = match dst_ip.parse::<Ipv4Addr>() {\n-    Ok(ip) => u32::from_ne_bytes(ip.octets()),  // Native endian from octets\n+    Ok(ip) => u32::from_be_bytes(ip.octets()),  // Network (big-endian) from octets\n     Err(_) => return None,\n };\n```\n\n\n <!-- /improve --apply_suggestion=0 -->\n\n\n<details><summary>Suggestion importance[1-10]: 10</summary>\n\n__\n\nWhy: This suggestion fixes a critical bug where the IP address endianness was incorrect for little-endian systems, which would cause all eBPF lookups to fail on common architectures like x86_64.\n\n</details></details></td><td align=center>High\n\n</td></tr><tr><td>\n\n\n\n<details><summary>Fix inefficient full cache scan</summary>\n\n___\n\n**Improve cache performance by replacing the inefficient full scan of <code>local_cache</code> <br>with direct key lookups using <code>get()</code>. This involves performing two lookups to <br>handle wildcard <code>src_port</code> matching.**\n\n[bastion-rs/src/ebpf_loader.rs [166-177]](https://github.com/shipdocs/bastion-firewall/pull/19/files#diff-e8428db524dc3ec7ede28ac53f192c94e09281022505aa28e5289ed836b939aeR166-R177)\n\n```diff\n // Check local cache first (faster than eBPF map query)\n-for ((cached_src_port, cached_dst_ip, cached_dst_port, cached_pid), (_pid, timestamp)) in &self.local_cache {\n-    // Match on dst_ip and dst_port (src_port may be 0 in eBPF entries)\n-    if (*cached_src_port == 0 || *cached_src_port == src_port) \n-        && *cached_dst_ip == dst_ip_u32 \n-        && *cached_dst_port == dst_port {\n-        if timestamp.elapsed() < self.ttl {\n-            debug!(\"Found PID {} in local cache for {}:{}\", cached_pid, dst_ip, dst_port);\n-            return Some(*cached_pid);\n-        }\n+// First, try a lookup with the specific source port.\n+let key = (src_port, dst_ip_u32, dst_port);\n+if let Some((pid, timestamp)) = self.local_cache.get(&key) {\n+    if timestamp.elapsed() < self.ttl {\n+        debug!(\"Found PID {} in local cache for {}:{}\", pid, dst_ip, dst_port);\n+        return Some(*pid);\n     }\n }\n \n+// If not found, try a lookup with a wildcard source port (0).\n+let wildcard_key = (0, dst_ip_u32, dst_port);\n+if let Some((pid, timestamp)) = self.local_cache.get(&wildcard_key) {\n+    if timestamp.elapsed() < self.ttl {\n+        debug!(\"Found PID {} in local cache (wildcard) for {}:{}\", pid, dst_ip, dst_port);\n+        return Some(*pid);\n+    }\n+}\n+\n```\n\n\n <!-- /improve --apply_suggestion=1 -->\n\n\n<details><summary>Suggestion importance[1-10]: 9</summary>\n\n__\n\nWhy: The suggestion correctly identifies a significant performance flaw where the local cache is iterated instead of being accessed by key, which would lead to O(n) complexity and degrade performance as the cache grows.\n\n</details></details></td><td align=center>High\n\n</td></tr><tr><td>\n\n\n\n<details><summary>Only ignore spontaneous closes</summary>\n\n___\n\n**In <code>closeEvent</code>, only ignore user-initiated close events by checking <br><code>event.spontaneous()</code>, allowing programmatic closes from buttons or timeouts to <br>function correctly.**\n\n[bastion/gui_qt.py [378-380]](https://github.com/shipdocs/bastion-firewall/pull/19/files#diff-f9f219109b878859f078120342e6af5b34efa439fd52b2b3cec00b97cb0fe859R378-R380)\n\n```diff\n def closeEvent(self, event):\n     \"\"\"Prevent accidental dismissal - only allow closing via buttons or timeout\"\"\"\n-    event.ignore()\n+    if event.spontaneous():\n+        event.ignore()\n+    else:\n+        super().closeEvent(event)\n```\n\n\n\n\n\n\n<details><summary>Suggestion importance[1-10]: 8</summary>\n\n__\n\nWhy: The suggestion correctly points out that ignoring all close events is too aggressive and could block legitimate programmatic closes, proposing a more precise fix using `event.spontaneous()` that improves robustness.\n\n</details></details></td><td align=center>Medium\n\n</td></tr><tr><td>\n\n\n\n<details><summary>Prevent multiple concurrent GUI connections<!-- not_implemented --></summary>\n\n___\n\n**Modify the <code>run_socket_server</code> function to prevent multiple concurrent GUI <br>connections by accepting only one client at a time and waiting for it to <br>disconnect before accepting a new one.**\n\n[bastion-rs/src/main.rs [402-444]](https://github.com/shipdocs/bastion-firewall/pull/19/files#diff-8155b3e9f214baacbf16aadb39c6bbc9a913e8ef313ff1f48849fd9018ce4c34R402-R444)\n\n```diff\n fn run_socket_server(gui_state: Arc<Mutex<GuiState>>) {\n     // FIX #26: Handle missing parent directory gracefully\n     // Create socket directory\n     let socket_path = std::path::Path::new(SOCKET_PATH);\n     let socket_dir = match socket_path.parent() {\n         Some(dir) => dir,\n         None => {\n             error!(\"Socket path has no parent directory: {}\", SOCKET_PATH);\n             return;\n         }\n     };\n     std::fs::create_dir_all(socket_dir).ok();\n     let _ = std::fs::remove_file(SOCKET_PATH);\n     \n     let listener = match UnixListener::bind(SOCKET_PATH) {\n         Ok(l) => l,\n         Err(e) => {\n             error!(\"Failed to bind socket: {}\", e);\n             return;\n         }\n     };\n     \n     #[cfg(unix)]\n     {\n         use std::os::unix::fs::PermissionsExt;\n         // Allow all local users to connect to the socket\n         let _ = std::fs::set_permissions(SOCKET_PATH, std::fs::Permissions::from_mode(0o666));\n     }\n     \n     info!(\"Socket server listening on {}\", SOCKET_PATH);\n     \n-    for stream in listener.incoming() {\n-        match stream {\n-            Ok(s) => {\n-                    info!(\"GUI client connecting\");\n-                gui_state.lock().set_connection(s);\n+    // Loop to accept connections, but handle one at a time.\n+    loop {\n+        match listener.accept() {\n+            Ok((stream, _)) => {\n+                info!(\"GUI client connecting\");\n+                // Set the connection in the shared state\n+                gui_state.lock().set_connection(stream);\n+\n+                // Wait until the GUI is disconnected before accepting a new one\n+                loop {\n+                    std::thread::sleep(std::time::Duration::from_secs(1));\n+                    if !gui_state.lock().is_connected() {\n+                        info!(\"GUI disconnected, ready to accept new connection.\");\n+                        break;\n+                    }\n+                }\n             }\n             Err(e) => {\n                 error!(\"Socket accept error: {}\", e);\n+                // Avoid busy-looping on error\n+                std::thread::sleep(std::time::Duration::from_secs(1));\n             }\n         }\n     }\n }\n```\n\n\n <!-- /improve --apply_suggestion=3 -->\n\n\n<details><summary>Suggestion importance[1-10]: 7</summary>\n\n__\n\nWhy: The suggestion correctly identifies a race condition where a new connection can overwrite an existing one, and proposes a robust solution to handle only one GUI client at a time, improving the daemon's reliability.\n\n</details></details></td><td align=center>Medium\n\n</td></tr><tr><td rowspan=1>Security</td>\n<td>\n\n\n\n<details><summary>Restrict whitelist to trusted applications</summary>\n\n___\n\n**Enhance security by restricting the DNS and loopback whitelists to only allow <br>traffic from trusted system binaries, preventing potential abuse by untrusted <br>applications.**\n\n[bastion-rs/src/whitelist.rs [75-89]](https://github.com/shipdocs/bastion-firewall/pull/19/files#diff-937a7f41c555573f431cef9c8d0a21808ffd5eab76a727af3fa167760b4eeb9cR75-R89)\n\n```diff\n-// 1. Localhost connections - auto-allow all (low risk, internal traffic)\n+let is_trusted_path = SYSTEM_PATHS.contains(app_path) || app_path.starts_with(\"/usr/lib/systemd/\");\n+\n+// 1. Localhost connections - only for trusted binaries to prevent local attacks\n if let Ok(ip) = dest_ip.parse::<std::net::IpAddr>() {\n     if ip.is_loopback() {\n-        return (true, \"Localhost\");\n+        if is_trusted_path {\n+            return (true, \"Localhost (trusted)\");\n+        }\n     }\n }\n-// Also check string patterns for systemd-resolved\n-if dest_ip == \"127.0.0.53\" || dest_ip.starts_with(\"127.\") {\n-    return (true, \"Localhost\");\n+\n+// 2. DNS traffic - only for trusted binaries\n+if dest_port == 53 {\n+    if is_trusted_path {\n+        return (true, \"DNS (trusted)\");\n+    }\n }\n \n-// 2. DNS traffic - auto-allow (needed for everything to work)\n-if dest_port == 53 {\n-    return (true, \"DNS\");\n-}\n-\n```\n\n\n <!-- /improve --apply_suggestion=4 -->\n\n\n<details><summary>Suggestion importance[1-10]: 9</summary>\n\n__\n\nWhy: This suggestion correctly identifies a significant security weakness in the whitelist logic and proposes a crucial hardening improvement by restricting DNS and loopback access to trusted applications only.\n\n</details></details></td><td align=center>High\n\n</td></tr><tr><td rowspan=1>High-level</td>\n<td>\n\n\n\n<details><summary>Consolidate redundant build and installation scripts</summary>\n\n___\n\n**The PR includes multiple redundant build and installation scripts. These should <br>be consolidated into a single, unified script with clear targets to improve <br>maintainability and reduce confusion.**\n\n\n### Examples:\n\n\n\n<details>\n<summary>\n<a href=\"https://github.com/shipdocs/bastion-firewall/pull/19/files#diff-3bf64863e0e24bea916400a769a41a0f2b0c7da374ae38d2ce6d89b967902d87R1-R228\">build_deb_v2.sh [1-228]</a>\n</summary>\n\n\n\n```bash\n#!/bin/bash\n#\n# Build Debian package for Bastion Firewall v2.0 (Rust Daemon)\n#\n\nset -e\n\nVERSION=\"2.0.0\"\n\n# Colors\n\n ... (clipped 218 lines)\n```\n</details>\n\n\n\n<details>\n<summary>\n<a href=\"https://github.com/shipdocs/bastion-firewall/pull/19/files#diff-5ff8ce75532c01d42d4af24ef679dd19b1a225266046c14cd5d4493e144a30ebR1-R289\">build_deb.sh [1-289]</a>\n</summary>\n\n\n\n```bash\n#!/bin/bash\nset -e\n\nVERSION=\"2.0.0\"\n\nGREEN='\\033[0;32m'\nBLUE='\\033[0;34m'\nRED='\\033[0;31m'\nNC='\\033[0m'\n\n\n ... (clipped 279 lines)\n```\n</details>\n\n\n\n\n### Solution Walkthrough:\n\n\n\n#### Before:\n```bash\n# To build the .deb package, a developer might find:\n# 1. A modified old script\n$ ./build_deb.sh\n\n# 2. A new, more polished script\n$ ./build_deb_v2.sh\n\n# To set up the environment, there's another script:\n$ ./install_rust_daemon.sh\n\n# To install the final package, yet another script:\n$ sudo ./install.sh\n\n```\n\n\n\n#### After:\n```bash\n# A single, unified build script with clear targets\n$ ./build.sh [command]\n\n# Where command is one of:\n# 'setup-dev' -> Installs build dependencies (replaces install_rust_daemon.sh)\n# 'package'   -> Builds the .deb package (replaces build_deb.sh and build_deb_v2.sh)\n# 'install'   -> Installs the built package (replaces install.sh)\n\n# Example usage:\n$ ./build.sh setup-dev\n$ ./build.sh package\n$ sudo ./build.sh install\n\n```\n\n\n\n\n<details><summary>Suggestion importance[1-10]: 7</summary>\n\n__\n\nWhy: The suggestion correctly identifies significant redundancy between `build_deb.sh` and `build_deb_v2.sh`, which creates confusion and future maintenance issues for the project's build system.\n\n\n</details></details></td><td align=center>Medium\n\n</td></tr><tr><td rowspan=3>General</td>\n<td>\n\n\n\n<details><summary>Clear cache on new load</summary>\n\n___\n\n**Clear the local cache when a new eBPF program is loaded to prevent returning <br>stale PIDs from a previous instance.**\n\n[bastion-rs/src/ebpf_loader.rs [130-131]](https://github.com/shipdocs/bastion-firewall/pull/19/files#diff-e8428db524dc3ec7ede28ac53f192c94e09281022505aa28e5289ed836b939aeR130-R131)\n\n```diff\n+self.local_cache.clear();\n self.bpf = Some(bpf);\n info!(\"eBPF program loaded and kprobes attached successfully\");\n```\n\n\n <!-- /improve --apply_suggestion=6 -->\n\n\n<details><summary>Suggestion importance[1-10]: 7</summary>\n\n__\n\nWhy: The suggestion correctly points out that the local cache should be cleared when a new eBPF program is loaded to prevent returning stale data, which improves the correctness and reliability of the PID lookup.\n\n</details></details></td><td align=center>Medium\n\n</td></tr><tr><td>\n\n\n\n<details><summary>Log JSON serialization errors</summary>\n\n___\n\n**Add error logging for JSON serialization failures in the IPC handler to aid in <br>diagnosing malformed stats payloads.**\n\n[bastion-rs/src/ipc.rs [209-213]](https://github.com/shipdocs/bastion-firewall/pull/19/files#diff-4c7599eee277596ba6fcfe58891e36682de025d205bf06cc30c04a69193d01d9R209-R213)\n\n```diff\n-if let Ok(json) = serde_json::to_string(&update) {\n-    if stream.write_all((json + \"\\n\").as_bytes()).is_err() {\n+match serde_json::to_string(&update) {\n+    Ok(json) => {\n+        if stream.write_all((json + \"\\n\").as_bytes()).is_err() {\n+            error!(\"Failed to write stats update to GUI\");\n+            break;\n+        }\n+    }\n+    Err(e) => {\n+        error!(\"Failed to serialize stats update: {}\", e);\n         break;\n     }\n }\n```\n\n\n <!-- /improve --apply_suggestion=7 -->\n\n\n<details><summary>Suggestion importance[1-10]: 6</summary>\n\n__\n\nWhy: The suggestion improves error handling by logging failures during JSON serialization, which is important for diagnosing issues with IPC communication, though such failures should be rare with the current data structures.\n\n</details></details></td><td align=center>Low\n\n</td></tr><tr><td>\n\n\n\n<details><summary>Make dialog explicitly non-modal</summary>\n\n___\n\n**Explicitly set the dialog's window modality to <code>NonModal</code> to ensure it does not <br>block other windows.**\n\n[bastion/gui_qt.py [216-222]](https://github.com/shipdocs/bastion-firewall/pull/19/files#diff-f9f219109b878859f078120342e6af5b34efa439fd52b2b3cec00b97cb0fe859R216-R222)\n\n```diff\n+self.setWindowModality(Qt.WindowModality.NonModal)\n self.setWindowFlags(\n     Qt.WindowType.WindowStaysOnTopHint |\n     Qt.WindowType.FramelessWindowHint |\n-    Qt.WindowType.Tool  # Tool windows don't steal focus\n+    Qt.WindowType.Tool\n )\n self.setAttribute(Qt.WidgetAttribute.WA_ShowWithoutActivating)\n```\n\n\n <!-- /improve --apply_suggestion=8 -->\n\n\n<details><summary>Suggestion importance[1-10]: 3</summary>\n\n__\n\nWhy: While `setWindowModality(Qt.WindowModality.NonModal)` is good practice for clarity, the combination of `Qt.WindowType.Tool` and `dialog.show()` already achieves non-modal behavior, making this a minor improvement.\n\n</details></details></td><td align=center>Low\n\n</td></tr>\n<tr><td align=\"center\" colspan=\"2\">\n\n <!-- /improve_multi --more_suggestions=true -->\n\n</td><td></td></tr></tbody></table>\n\n</details>\n","createdAt":"2025-12-28T20:01:38Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/shipdocs/bastion-firewall/pull/19#issuecomment-3695004300","viewerDidAuthor":false},{"id":"IC_kwDOQsqSJc7cPUv9","author":{"login":"codeant-ai"},"authorAssociation":"NONE","body":"## Nitpicks üîç\n\n<table>\n<tr><td>üîí&nbsp;<strong>No security issues identified</strong></td></tr>\n<tr><td>‚ö°&nbsp;<strong>Recommended areas for review</strong><br><br>\n\n- [ ] <a href='https://github.com/shipdocs/bastion-firewall/pull/19/files#diff-abdc9834062723adc38853e0643790eedfc75342782c0bd3e7f9e156fecbc0e2R9-R24'><strong>sys.path manipulation</strong></a><br>The script mutates `sys.path` with global system paths (e.g. `/usr/share/bastion-firewall`, `/usr/local/lib/.../dist-packages`, `/usr/lib/python3/dist-packages`) and inserts the script directory at index 0. This affects import resolution order and can be abused if any of those paths are writable by untrusted users. Validate paths and prefer controlled loading mechanisms or restrict to trusted directories.<br>\n\n- [ ] <a href='https://github.com/shipdocs/bastion-firewall/pull/19/files#diff-abdc9834062723adc38853e0643790eedfc75342782c0bd3e7f9e156fecbc0e2R33-R53'><strong>FileHandler override correctness</strong></a><br>`PermissionFileHandler._open` calls `super()._open()` but does not return the opened file object and swallows many exceptions. Also it attempts `os.chown`/`grp.getgrnam` unconditionally; calling chown when not root will raise (caught, but silently). This might break logging initialization or hide real failures. Ensure the override follows `logging.FileHandler._open` contract (return stream) and restrict chown to when running as root.<br>\n\n- [ ] <a href='https://github.com/shipdocs/bastion-firewall/pull/19/files#diff-abdc9834062723adc38853e0643790eedfc75342782c0bd3e7f9e156fecbc0e2R27-R62'><strong>Privileged file setup</strong></a><br>The script creates and secures /var/log/bastion-daemon.log (mkdir + handler that chowns/chmods) before calling `require_root()` in `main()`. This can cause permission errors for non-root runs, or create a window where an attacker could influence file creation/ownership if the process runs without expected privileges. Consider deferring privileged filesystem operations until after a root check or fall back to a safe user-writable location when not root.<br>\n\n- [ ] <a href='https://github.com/shipdocs/bastion-firewall/pull/19/files#diff-794e65e0ee6053d90c158cf942f93caee8a9fb1473830f1ccd660cf865c90828R76-R85'><strong>Incomplete iptables cleanup</strong></a><br>The cleanup only targets a single NFQUEUE rule (`--queue-num 1`) and only the `OUTPUT` chain (IPv4 iptables). If the daemon used other queue numbers, other chains, or if the system used nftables/ip6tables, leftover rules may persist and continue affecting packet flow. Consider a more generic removal approach that searches for rules by comment/target or removes matching lines across IPv4/IPv6/nftables.<br>\n\n- [ ] <a href='https://github.com/shipdocs/bastion-firewall/pull/19/files#diff-f5c88428df02a75793d2429f5f9b8cb893cade30f44b37f82608a050b01448a9R57-R67'><strong>Potential info exposure</strong></a><br>GUI stdout/stderr is redirected to `/tmp/bastion-gui-$session_user.log`, a world-writable directory which may allow other users to read sensitive information. Logs should be sent to the journal or to a protected per-user location with appropriate ownership/permissions.<br>\n\n- [ ] <a href='https://github.com/shipdocs/bastion-firewall/pull/19/files#diff-8155b3e9f214baacbf16aadb39c6bbc9a913e8ef313ff1f48849fd9018ce4c34R424-R429'><strong>Insecure socket permissions</strong></a><br>The Unix socket at `SOCKET_PATH` is made world-writable/readable (`0o666`). Any local user can connect and potentially send forged GUI responses, causing unauthorized allow/block decisions or rule changes.<br>\n\n- [ ] <a href='https://github.com/shipdocs/bastion-firewall/pull/19/files#diff-03259569799f86b64ca1183f13eb7e316a579c0ba1bc8a28f79b3484b607061dR31-R36'><strong>Risky global policy fallback</strong></a><br>If NFQUEUE rules persist, the script falls back to flushing OUTPUT and setting policy ACCEPT. This could temporarily open the host to traffic if executed in a different context than intended; it should be a last-resort action with minimal blast radius and explicit logging/guarding.<br>\n\n- [ ] <a href='https://github.com/shipdocs/bastion-firewall/pull/19/files#diff-03259569799f86b64ca1183f13eb7e316a579c0ba1bc8a28f79b3484b607061dR11-R14'><strong>Aggressive process killing</strong></a><br>The script uses multiple unconditional `pkill -9 -f <pattern>` invocations which can kill unrelated processes that match the pattern and does so without attempting graceful shutdown first. This is risky on systems where process names overlap or when systemd-managed services are present. Consider a staged termination (SIGTERM, wait, then SIGKILL) or using `systemctl`/`pgrep` to limit scope.<br>\n\n- [ ] <a href='https://github.com/shipdocs/bastion-firewall/pull/19/files#diff-4c7599eee277596ba6fcfe58891e36682de025d205bf06cc30c04a69193d01d9R87-R98'><strong>Symlink TOCTOU</strong></a><br>The code checks whether the socket path is a symlink using `symlink_metadata` then calls `remove_file`. This is susceptible to a time-of-check/time-of-use (TOCTOU) race: an attacker could replace the file between the metadata check and the removal, potentially allowing deletion of an arbitrary target or enabling symlink attacks. Use an unlink operation that refuses to follow symlinks (e.g. unlinkat with AT_SYMLINK_NOFOLLOW) or create/bind to a temporary path and atomically rename.<br>\n\n- [ ] <a href='https://github.com/shipdocs/bastion-firewall/pull/19/files#diff-6ef817fa21be7006cbf746ace6de4a67b9e7133d44e799445e2731dfa4ef26a0R119-R130'><strong>TOCTOU / Existence Check</strong></a><br>The code calls `path.exists()` before opening the file. This creates a TOCTOU window and negates some of the security benefits of opening with `O_NOFOLLOW`. Prefer attempting to open the file and handle NotFound errors instead of a separate exists() check.<br>\n\n- [ ] <a href='https://github.com/shipdocs/bastion-firewall/pull/19/files#diff-937a7f41c555573f431cef9c8d0a21808ffd5eab76a727af3fa167760b4eeb9cR86-R89'><strong>DNS auto-allow policy</strong></a><br>The code currently auto-allows any connection where `dest_port == 53` (DNS) regardless of the calling binary. This conflicts with the comment that \"essential ports and localhost are only auto-allowed for trusted binaries\" and may let untrusted/malicious processes perform DNS-based exfiltration or reach remote resolvers unrestricted. Consider restricting DNS to trusted binaries or localhost only, or add stricter checks (e.g., allow only system resolvers or require the app to be trusted).<br>\n\n- [ ] <a href='https://github.com/shipdocs/bastion-firewall/pull/19/files#diff-937a7f41c555573f431cef9c8d0a21808ffd5eab76a727af3fa167760b4eeb9cR18-R41'><strong>Path-matching / canonicalization</strong></a><br>`SYSTEM_PATHS.contains(app_path)` requires an exact string match. Real-world `app_path` may be a symlink, contain different canonical forms, or be an argv/comm value rather than a full path, causing trusted system services to be missed or misclassified. Consider normalizing/canonicalizing paths before lookup or provide fallback checks (e.g., check the executable basename against a whitelist).<br>\n\n- [ ] <a href='https://github.com/shipdocs/bastion-firewall/pull/19/files#diff-937a7f41c555573f431cef9c8d0a21808ffd5eab76a727af3fa167760b4eeb9cR145-R157'><strong>Unnecessary allocations / inefficiency</strong></a><br>`get_app_category` lowercases the `name` once into `name_lower`, but each pattern comparison calls `to_lowercase()` on the literal, allocating new Strings repeatedly. This is wasteful in hot paths (many connections). Consider using lowercase literals or a precomputed static set of lowercase patterns to avoid repeated allocations.<br>\n\n</td></tr>\n</table>\n","createdAt":"2025-12-28T20:02:04Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/shipdocs/bastion-firewall/pull/19#issuecomment-3695004669","viewerDidAuthor":false},{"id":"IC_kwDOQsqSJc7cPV4G","author":{"login":"codeant-ai"},"authorAssociation":"NONE","body":"## PR Code Suggestions ‚ú®\n\n<!-- ab3c5d7 -->\n\n<table><thead><tr><td>Category</td><td align=left>Suggestion&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </td><td align=center>Score</td></tr><tbody><tr><td rowspan=15><strong>Logic error</strong></td>\n<td>\n\n\n\n<details><summary>The custom logging file handler does not return the opened stream, causing file logging to break at runtime</summary>\n\n___\n\n\n**The overridden <code>_open</code> method in the custom logging handler calls the parent <code>_open</code> but <br>does not return the resulting stream, so <code>logging.FileHandler</code> ends up with <br><code>self.stream = None</code>, causing logging to the file to fail at runtime with <br>AttributeError and silently breaking file logging.**\n\n[bastion-daemon-legacy.py [37-53]](https://github.com/shipdocs/bastion-firewall/pull/19/files#diff-abdc9834062723adc38853e0643790eedfc75342782c0bd3e7f9e156fecbc0e2R37-R53)\n\n```diff\n def _open(self):\n-    # Call parent's _open to create the file\n-    super()._open()\n+    # Call parent's _open to create the file and get the stream\n+    stream = super()._open()\n     # Set proper permissions (640 = rw-r-----)\n     try:\n         import grp\n         os.chmod(self.baseFilename, 0o640)\n         # Try to set group to bastion if the group exists\n         try:\n             bastion_gid = grp.getgrnam('bastion').gr_gid\n             os.chown(self.baseFilename, 0, bastion_gid)  # root:bastion\n         except KeyError:\n             # Group doesn't exist, just keep default\n             pass\n     except (OSError, ImportError):\n         # Fail silently if we can't set permissions\n         pass\n+    return stream\n \n```\n<details><summary>Suggestion importance[1-10]: 10</summary>\n\nWhy it matters? ü§î: The override of logging.FileHandler._open() currently calls super()._open() but does not return the stream. The base implementation returns an open file object which FileHandler expects to assign to self.stream. Without returning it, self.stream will be None and attempts to write to the file handler will raise AttributeError or silently fail. Returning the stream (stream = super()._open(); ...; return stream) fixes a real runtime bug in the PR change.\n\n</details></details></td><td align=center>10\n\n</td></tr><tr><td>\n\n\n\n<details><summary>‚úÖ <s>Checking <code>$?</code> after a backgrounded <code>systemd-run</code> never detects runtime failures so the fallback launch path may never be used even when the GUI fails to start</s></summary>\n\n___\n\n<details><summary><b>Suggestion Impact:</b></summary>The commit removed the trailing '&' from the systemd-run invocation, making $? reflect systemd-run's exit status so the fallback block can trigger on failure.\n\n\ncode diff:\n\n```diff\n             systemd-run --user --machine=\"${session_user}@.host\" \\\n                 --setenv=QT_QPA_PLATFORM=wayland \\\n-                /usr/bin/bastion-gui &\n-            \n+                /usr/bin/bastion-gui\n+\n             # Alternative fallback if systemd-run doesn't work\n             if [ $? -ne 0 ]; then\n```\n\n</details>\n\n\n___\n\n\n**The exit status check for the <code>systemd-run</code> call is unreliable because the command is <br>run in the background with <code>&</code>, so <code>$?</code> only reflects that the background job was <br>spawned, not whether <code>systemd-run</code> itself succeeded; this means the fallback block <br>will not execute even if <code>systemd-run</code> fails at runtime and the GUI never starts.**\n\n[bastion-launch-gui.sh [41-48]](https://github.com/shipdocs/bastion-firewall/pull/19/files#diff-f5c88428df02a75793d2429f5f9b8cb893cade30f44b37f82608a050b01448a9R41-R48)\n\n```diff\n # Use systemd-run to launch as the user in their session\n # This properly inherits the user's environment\n systemd-run --user --machine=\"${session_user}@.host\" \\\n     --setenv=QT_QPA_PLATFORM=wayland \\\n-    /usr/bin/bastion-gui &\n+    /usr/bin/bastion-gui\n \n # Alternative fallback if systemd-run doesn't work\n if [ $? -ne 0 ]; then\n \n```\n<details><summary>Suggestion importance[1-10]: 10</summary>\n\nWhy it matters? ü§î: This is a legitimate logic issue. Backgrounding the command with `&` returns the shell job-spawn success, not the exit status of the launched program. `$?` in that spot will generally only tell you the spawn succeeded, so the fallback branch will rarely trigger even if `systemd-run` fails to start the service. Removing the backgrounding (or using a synchronous variant like `systemd-run --wait` / checking the unit activation via `systemctl`/`busctl` or capturing the exit of `systemd-run` directly) is necessary to correctly detect failures and execute the fallback block.\n\n</details></details></td><td align=center>10\n\n</td></tr><tr><td>\n\n\n\n<details><summary>Wayland fallback uses <code>sudo</code> in a way that strips critical environment variables so the GUI cannot connect to the user's Wayland and DBus session</summary>\n\n___\n\n\n**In the Wayland fallback path, environment variables like <code>XDG_RUNTIME_DIR</code>, <br><code>WAYLAND_DISPLAY</code>, <code>DBUS_SESSION_BUS_ADDRESS</code>, and <code>QT_QPA_PLATFORM</code> are passed as <br>arguments to <code>sudo</code>, but with default <code>sudo</code> configuration they are typically stripped <br>by <code>env_reset</code>, so the launched GUI process will not receive the required Wayland and <br>DBus environment and is likely to fail to display.**\n\n[bastion-launch-gui.sh [51-57]](https://github.com/shipdocs/bastion-firewall/pull/19/files#diff-f5c88428df02a75793d2429f5f9b8cb893cade30f44b37f82608a050b01448a9R51-R57)\n\n```diff\n if [[ \"$session_type\" == \"wayland\" ]]; then\n-    sudo -u \"$session_user\" \\\n+    sudo -u \"$session_user\" env \\\n         XDG_RUNTIME_DIR=\"/run/user/$user_uid\" \\\n         WAYLAND_DISPLAY=\"wayland-0\" \\\n         DBUS_SESSION_BUS_ADDRESS=\"unix:path=/run/user/$user_uid/bus\" \\\n         QT_QPA_PLATFORM=\"wayland;xcb\" \\\n         setsid /usr/bin/bastion-gui </dev/null >/tmp/bastion-gui-$session_user.log 2>&1 &\n \n```\n<details><summary>Suggestion importance[1-10]: 10</summary>\n\nWhy it matters? ü§î: Also correct: environment assignments placed before `sudo` do not guarantee those environment variables reach the target process when `sudo` resets the environment (default `env_reset`). Many distros' sudoers will strip such variables, so the launched GUI will often lack XDG_RUNTIME_DIR/DBUS address and fail to connect. Using `sudo -u user env VAR=... cmd` or `runuser`, `su -c 'env ... cmd'`, or adjusting sudoers (or using systemd user services) is required to preserve the required environment for Wayland/DBus.\n\n</details></details></td><td align=center>10\n\n</td></tr><tr><td>\n\n\n\n<details><summary>X11 fallback loses the display and session environment when passing variables through <code>sudo</code>, causing the GUI to start without a working X server or DBus connection</summary>\n\n___\n\n\n**In the X11 fallback path, <code>DISPLAY</code>, <code>XAUTHORITY</code>, <code>XDG_RUNTIME_DIR</code>, and <br><code>DBUS_SESSION_BUS_ADDRESS</code> are also passed as environment assignments to <code>sudo</code>, but <br>default <code>sudo</code> settings will usually drop these, so the GUI process often starts <br>without a valid X11 or DBus environment and fails to show a window.**\n\n[bastion-launch-gui.sh [58-66]](https://github.com/shipdocs/bastion-firewall/pull/19/files#diff-f5c88428df02a75793d2429f5f9b8cb893cade30f44b37f82608a050b01448a9R58-R66)\n\n```diff\n else\n     display=$(loginctl show-session \"$session\" -p Display --value 2>/dev/null)\n     display=\"${display:-:0}\"\n-    sudo -u \"$session_user\" \\\n+    sudo -u \"$session_user\" env \\\n         DISPLAY=\"$display\" \\\n         XAUTHORITY=\"$user_home/.Xauthority\" \\\n         XDG_RUNTIME_DIR=\"/run/user/$user_uid\" \\\n         DBUS_SESSION_BUS_ADDRESS=\"unix:path=/run/user/$user_uid/bus\" \\\n         setsid /usr/bin/bastion-gui </dev/null >/tmp/bastion-gui-$session_user.log 2>&1 &\n \n```\n<details><summary>Suggestion importance[1-10]: 10</summary>\n\nWhy it matters? ü§î: Same real problem as the Wayland case. `sudo` commonly clears environment variables, so passing DISPLAY/XAUTHORITY/XDG_RUNTIME_DIR/DBUS_* as assignments before `sudo` won't reliably propagate them into the launched process. The GUI will often start without a valid X11/DBus context and fail to display. Use `sudo -u user env ...`, `runuser`, or a systemd user session to ensure the environment is preserved.\n\n</details></details></td><td align=center>10\n\n</td></tr><tr><td>\n\n\n\n<details><summary>Using rustup without first verifying it is installed and on PATH will cause the script to abort with a command-not-found error</summary>\n\n___\n\n\n**The script checks only for <code>cargo</code> but then unconditionally uses <code>rustup</code> later; if Rust <br>was installed without <code>rustup</code> or <code>rustup</code> is not on PATH, the <code>rustup</code> calls will fail <br>with \"command not found\" under <code>set -e</code>, terminating the script with a confusing error <br>instead of clearly reporting the missing tool.**\n\n[bastion-rs/build_ebpf.sh [14-19]](https://github.com/shipdocs/bastion-firewall/pull/19/files#diff-2baf370452cb204afe39e9c380dc40eba70f8c62c11246f9f61a3d176245d121R14-R19)\n\n```diff\n # Check for Rust\n+export PATH=\"$HOME/.cargo/bin:$PATH\"\n+\n if ! command -v cargo >/dev/null 2>&1; then\n-    echo \"ERROR: Rust not installed\"\n+    echo \"ERROR: Rust (cargo) not installed or not in PATH\"\n     echo \"Install with: curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh\"\n     exit 1\n fi\n \n+if ! command -v rustup >/dev/null 2>&1; then\n+    echo \"ERROR: rustup not installed or not in PATH\"\n+    echo \"Please install Rust using rustup from https://rustup.rs/\"\n+    exit 1\n+fi\n+\n```\n<details><summary>Suggestion importance[1-10]: 10</summary>\n\nWhy it matters? ü§î: The PR's final script calls rustup later (rustup toolchain list and rustup component list) but only verifies cargo is present here. If rustup is not installed or not on PATH the script will fail under set -e with a cryptic \"command not found\" from rustup instead of a clear, actionable error. The proposed check (export PATH and explicit rustup existence test) is practical, prevents confusing failures, and directly fixes a real usability/robustness issue in this script. The change is small and local to this script.\n\n</details></details></td><td align=center>10\n\n</td></tr><tr><td>\n\n\n\n<details><summary>Re-running the script adds duplicate root bypass rules because it never checks if the iptables rule already exists</summary>\n\n___\n\n\n**The root bypass iptables rule is inserted unconditionally on every run, so <br>re-running the script will keep adding duplicate <code>BASTION_BYPASS</code> rules for UID 0, <br>bloating the OUTPUT chain and making rule ordering/cleanup harder; checking for the <br>rule first makes the script idempotent.**\n\n[bastion-rs/start_daemon.sh [12]](https://github.com/shipdocs/bastion-firewall/pull/19/files#diff-1fe9c90b2aaf50e35cbb74dba6415c8d301833c0bd3e06629ff5ba8e81c9916cR12-R12)\n\n```diff\n+iptables -C OUTPUT -m owner --uid-owner 0 -m comment --comment \"BASTION_BYPASS\" -j ACCEPT 2>/dev/null || \\\n iptables -I OUTPUT 1 -m owner --uid-owner 0 -m comment --comment \"BASTION_BYPASS\" -j ACCEPT\n \n```\n<details><summary>Suggestion importance[1-10]: 10</summary>\n\nWhy it matters? ü§î: The PR's final file unconditionally inserts a UID 0 bypass rule (see the existing code). Running the script multiple times will prepend identical ACCEPT rules repeatedly, which bloats the chain and can change rule ordering unexpectedly. Using `iptables -C ... || iptables -I ...` makes the operation idempotent and addresses a real operational bug rather than a cosmetic nit.\n\n</details></details></td><td align=center>10\n\n</td></tr><tr><td>\n\n\n\n<details><summary>The script adds duplicate systemd-network bypass rules because it never checks whether that iptables rule is already present</summary>\n\n___\n\n\n**The <code>systemd-network</code> group bypass rule is also inserted unconditionally on each run, <br>so every invocation of the script adds another identical <code>BASTION_BYPASS</code> rule for <br>that group, leading to multiple redundant ACCEPT rules and complicating debugging <br>and cleanup.**\n\n[bastion-rs/start_daemon.sh [15]](https://github.com/shipdocs/bastion-firewall/pull/19/files#diff-1fe9c90b2aaf50e35cbb74dba6415c8d301833c0bd3e06629ff5ba8e81c9916cR15-R15)\n\n```diff\n+iptables -C OUTPUT -m owner --gid-owner systemd-network -m comment --comment \"BASTION_BYPASS\" -j ACCEPT 2>/dev/null || \\\n iptables -I OUTPUT 1 -m owner --gid-owner systemd-network -m comment --comment \"BASTION_BYPASS\" -j ACCEPT 2>/dev/null || true\n \n```\n<details><summary>Suggestion importance[1-10]: 10</summary>\n\nWhy it matters? ü§î: The script always inserts the group-based bypass if the `iptables -I` runs; even though the command suppresses errors, it doesn't avoid creating duplicates. The suggested `iptables -C ... || iptables -I ...` pattern makes this idempotent and prevents accumulating redundant rules when the script or other services run the same rule.\n\n</details></details></td><td align=center>10\n\n</td></tr><tr><td>\n\n\n\n<details><summary>NFQUEUE is added multiple times because the script does not verify whether the queue rule already exists before inserting it</summary>\n\n___\n\n\n**The NFQUEUE rule is always inserted without checking for an existing identical rule, <br>so repeated runs of this script or running it alongside the systemd service (which <br>also installs the same NFQUEUE rule) will create duplicate, redundant NFQUEUE <br>entries in the OUTPUT chain.**\n\n[bastion-rs/start_daemon.sh [19]](https://github.com/shipdocs/bastion-firewall/pull/19/files#diff-1fe9c90b2aaf50e35cbb74dba6415c8d301833c0bd3e06629ff5ba8e81c9916cR19-R19)\n\n```diff\n+iptables -C OUTPUT -m state --state NEW -j NFQUEUE --queue-num 1 --queue-bypass 2>/dev/null || \\\n iptables -I OUTPUT 3 -m state --state NEW -j NFQUEUE --queue-num 1 --queue-bypass\n \n```\n<details><summary>Suggestion importance[1-10]: 10</summary>\n\nWhy it matters? ü§î: The PR adds an NFQUEUE rule unconditionally at a fixed position. Duplicate NFQUEUE rules are a real operational problem (confusing packet handling, unexpected ordering). Checking with `iptables -C` before inserting is a simple, correct fix to make the script safe to re-run.\n\n</details></details></td><td align=center>10\n\n</td></tr><tr><td>\n\n\n\n<details><summary>Cleanup no longer matches the NFQUEUE rule created with <code>--queue-bypass</code>, so rules are not removed and accumulate over time</summary>\n\n___\n\n\n**The NFQUEUE rule inserted by the setup function now includes the <code>--queue-bypass</code> <br>flag, but the cleanup function deletes rules using a spec that omits this flag, so <br><code>iptables -D</code> will no longer match and the NFQUEUE rules will accumulate across <br>restarts instead of being cleaned up, leading to multiple active NFQUEUE rules and <br>inconsistent firewall state.**\n\n[bastion/firewall_core.py [435-438]](https://github.com/shipdocs/bastion-firewall/pull/19/files#diff-addda00e3f7b10a3d93cf521c8ac77493dd72e358d3b82659fbff2a4d7517850R435-R438)\n\n```diff\n nfqueue_spec = [\n     '-m', 'state', '--state', 'NEW',\n-    '-j', 'NFQUEUE', '--queue-num', str(queue_num)\n+    '-j', 'NFQUEUE', '--queue-num', str(queue_num), '--queue-bypass'\n ]\n \n```\n<details><summary>Suggestion importance[1-10]: 10</summary>\n\nWhy it matters? ü§î: Correct. setup_nfqueue inserts the rule with '--queue-bypass', but cleanup_nfqueue builds a spec without that flag. iptables requires the exact rule match for '-D' to succeed, so the current cleanup will fail to remove the rules that include '--queue-bypass' and they will accumulate. Updating nfqueue_spec to include '--queue-bypass' (or attempting deletion of both variants) fixes a real logic bug affecting runtime firewall state.\n\n</details></details></td><td align=center>10\n\n</td></tr><tr><td>\n\n\n\n<details><summary>The installer uses a .deb filename that does not match the actual package name, causing a file-not-found error during installation</summary>\n\n___\n\n\n**The installer hardcodes the .deb filename as <code>bastion-firewall_2.0.0_all.deb</code>, but the <br>documented/package name in the repo is <code>bastion-firewall_2.0.0_amd64.deb</code>, so the <br>script will exit with \"not found\" even when the correct package is present.**\n\n[install.sh [12-17]](https://github.com/shipdocs/bastion-firewall/pull/19/files#diff-043df5bdbf6639d7a77e1d44c5226fd7371e5259a1e4df3a0dd5d64c30dca44fR12-R17)\n\n```diff\n-DEB_FILE=\"bastion-firewall_2.0.0_all.deb\"\n+DEB_FILE=\"bastion-firewall_2.0.0_amd64.deb\"\n \n if [ ! -f \"$DEB_FILE\" ]; then\n     echo \"ERROR: $DEB_FILE not found in current directory\"\n     exit 1\n fi\n \n```\n<details><summary>Suggestion importance[1-10]: 10</summary>\n\nWhy it matters? ü§î: Verified: the repo's TESTING.md documents the package as bastion-firewall_2.0.0_amd64.deb while the script looks for bastion-firewall_2.0.0_all.deb.\nThat mismatch will cause the script to fail with \"not found\" even when the correct .deb is present. Changing the filename to the documented amd64 name (or making the script accept either) fixes a real, reproducible install failure ‚Äî not a mere stylistic change.\n\n</details></details></td><td align=center>10\n\n</td></tr><tr><td>\n\n\n\n<details><summary>‚úÖ <s>The unit runs a post-start command referencing a non-existent GUI launcher binary, causing the service activation to fail</s></summary>\n\n___\n\n<details><summary><b>Suggestion Impact:</b></summary>The committed patch removes the entire systemd unit content, which includes deleting the problematic ExecStartPost=/usr/bin/bastion-launch-gui line (thus eliminating the failure mode), though it does so by deleting everything rather than commenting out just that line.\n\n\ncode diff:\n\n```diff\n-ExecStart=/usr/bin/bastion-daemon\n-ExecStartPost=/usr/bin/bastion-launch-gui\n-Restart=on-failure\n```\n\n</details>\n\n\n___\n\n\n**The service uses an <code>ExecStartPost</code> command to launch a GUI helper that is not present <br>anywhere else in the repository, so on a standard installation following the <br>provided install script this binary will not exist and the post-start step will <br>fail, causing the unit to be marked as failed even though the daemon itself may be <br>running.**\n\n[bastion-daemon.service [11]](https://github.com/shipdocs/bastion-firewall/pull/19/files#diff-688c0f4218bd1a9503b3d8930a05d34394e57ad608e093de7dce9d01c48f4ae4R11-R11)\n\n```diff\n-ExecStartPost=/usr/bin/bastion-launch-gui\n+# ExecStartPost=/usr/bin/bastion-launch-gui\n \n```\n<details><summary>Suggestion importance[1-10]: 10</summary>\n\nWhy it matters? ü§î: ExecStartPost is present in the final unit file and if that binary is not installed or fails, systemd will mark the unit as failed despite the main ExecStart succeeding (ExecStartPost failures affect the unit state by default). This is a real operational/runtime issue, not mere style. The suggestion to remove or neutralize the ExecStartPost is reasonable unless the packaging/install process guarantees that /usr/bin/bastion-launch-gui is provided and reliable. At minimum the unit should either ensure the helper is installed, prefix the ExecStartPost with \"-\" to ignore failures, or make the step conditional. Leaving the raw ExecStartPost as-is can cause unexpected failed units on installs that don't include the GUI helper.\n\n</details></details></td><td align=center>10\n\n</td></tr><tr><td>\n\n\n\n<details><summary>Ignoring the pkill exit status makes the script claim success even when the daemon is not reloaded</summary>\n\n___\n\n\n**Because the script forces <code>pkill</code> to be ignored (<code>|| true</code>) and always exits with status <br>0, the GUI will report a successful configuration save even if the daemon is not <br>running and no reload occurred, which is misleading behavior and can hide real <br>failures.**\n\n[bastion-reload-config [33-34]](https://github.com/shipdocs/bastion-firewall/pull/19/files#diff-67e8af6fb87ff1c8e72c7e6a5dc6f9f5fb0245674bdf14947e37d9bfff8e7edcR33-R34)\n\n```diff\n # Signal the daemon to reload config and clear cache\n-pkill -HUP -f bastion-daemon || true\n+if ! pkill -HUP -f bastion-daemon; then\n+    echo \"Error: bastion-daemon is not running; could not reload configuration\" >&2\n+    exit 1\n+fi\n \n```\n<details><summary>Suggestion importance[1-10]: 10</summary>\n\nWhy it matters? ü§î: The current code masks pkill failures by swallowing the exit status (pkill ... || true) so the script will return success even if no bastion-daemon process existed or the signal failed. That can mislead a GUI or calling process into believing the reload succeeded. Making the script surface the failure (or at least log and return non-zero) is appropriate because reloading the daemon is a core part of this helper's responsibility; the suggested change correctly makes failures visible.\n\n</details></details></td><td align=center>10\n\n</td></tr><tr><td>\n\n\n\n<details><summary>‚úÖ <s>NFQUEUE rule insertion is not idempotent and can create duplicate iptables rules on restart</s></summary>\n\n___\n\n<details><summary><b>Suggestion Impact:</b></summary>The commit removed the entire `bastion-daemon.service` unit content, including the non-idempotent `ExecStartPre` iptables insertion line. This eliminates the duplication issue by removing the rule insertion from this unit, rather than implementing the suggested `iptables -C ... || iptables -I ...` check.\n\n\ncode diff:\n\n```diff\n-[Service]\n-Type=simple\n-ExecStartPre=/usr/sbin/iptables -I OUTPUT 1 -m state --state NEW -j NFQUEUE --queue-num 1 --queue-bypass\n-ExecStart=/usr/bin/bastion-daemon\n-ExecStopPost=/usr/sbin/iptables -D OUTPUT -m state --state NEW -j NFQUEUE --queue-num 1 --queue-bypass\n-Restart=on-failure\n```\n\n</details>\n\n\n___\n\n\n**The <code>ExecStartPre</code> command always inserts a new NFQUEUE iptables rule without first <br>checking if an identical rule already exists, so if a similar rule was added <br>manually or by a previous version of the service, restarting this unit will <br>accumulate duplicate NFQUEUE rules and can break assumptions in the code that expect <br>exactly one such rule to be present.**\n\n[bastion-rs/bastion-daemon.service [9]](https://github.com/shipdocs/bastion-firewall/pull/19/files#diff-8b0db3141377c66f2eb8b3302b416dbf655072e6d90dc8657c6d2625785f5e28R9-R9)\n\n```diff\n-ExecStartPre=/usr/sbin/iptables -I OUTPUT 1 -m state --state NEW -j NFQUEUE --queue-num 1 --queue-bypass\n+ExecStartPre=/bin/sh -c 'iptables -C OUTPUT -m state --state NEW -j NFQUEUE --queue-num 1 --queue-bypass 2>/dev/null || iptables -I OUTPUT 1 -m state --state NEW -j NFQUEUE --queue-num 1 --queue-bypass'\n \n```\n<details><summary>Suggestion importance[1-10]: 10</summary>\n\nWhy it matters? ü§î: The current ExecStartPre unconditionally inserts an iptables rule which will create duplicates on repeated starts/reloads. The proposed change makes the operation idempotent by checking for the rule first (iptables -C) and only inserting if missing. This fixes a real operational bug (rule accumulation) rather than being purely cosmetic.\n\n</details></details></td><td align=center>10\n\n</td></tr><tr><td>\n\n\n\n<details><summary>Missing file handling leaves stale rules in memory instead of clearing them when the rules file is removed</summary>\n\n___\n\n\n**When <code>load_rules</code> is called after the rules file has been deleted, the in-memory rules <br>map is left unchanged, so stale rules continue to be enforced even though the file <br>is gone, contradicting the documented behavior that a missing file leaves the map <br>empty; you should explicitly clear the map when the file does not exist.**\n\n[bastion-rs/src/rules.rs [67-74]](https://github.com/shipdocs/bastion-firewall/pull/19/files#diff-c47d2760f80166076349ea945cbb73c168ebf9fd66ff57caff99298ded2e2a41R67-R74)\n\n```diff\n pub fn load_rules(&self) {\n     let path = Path::new(RULES_PATH);\n     if !path.exists() {\n         info!(\"No rules file at {}, starting with empty rules\", RULES_PATH);\n+        let mut rules = self.rules.write();\n+        rules.clear();\n         return;\n     }\n     \n     match fs::read_to_string(path) {\n \n```\n<details><summary>Suggestion importance[1-10]: 10</summary>\n\nWhy it matters? ü§î: The suggestion correctly points out a real logic bug: when the rules file is removed, load_rules returns early but does not clear the in-memory map, leaving stale rules active. The improved code simply clears the rules map before returning which matches the function documentation and expected behavior. This is a small, correct, and localized fix.\n\n</details></details></td><td align=center>10\n\n</td></tr><tr><td>\n\n\n\n<details><summary>The UDP handler decodes the <code>msg_name</code> pointer assuming little-endian representation, which breaks on big-endian systems and can cause invalid memory reads</summary>\n\n___\n\n\n**In <code>try_udp_sendmsg</code>, the code reconstructs the <code>msg_name</code> pointer using <br><code>u64::from_le_bytes</code>, which assumes little-endian layout and will produce a wrong <br>pointer value on big-endian architectures, leading to failed or unsafe <br><code>bpf_probe_read_user</code> calls; using <code>u64::from_ne_bytes</code> preserves correctness across <br>endianness.**\n\n[bastion-rs/ebpf/src/main.rs [258]](https://github.com/shipdocs/bastion-firewall/pull/19/files#diff-d989f00c672d286cc345dbbb7ede04f61840f66a577f697ff16bc5a5df47639eR258-R258)\n\n```diff\n-let msg_name = u64::from_le_bytes(msg_name_ptr);\n+let msg_name = u64::from_ne_bytes(msg_name_ptr);\n \n```\n<details><summary>Suggestion importance[1-10]: 10</summary>\n\nWhy it matters? ü§î: Decoding a raw pointer from byte bytes should use native-endian interpretation (from_ne_bytes) because the pointer bytes in memory are in the platform's endianness. Using from_le_bytes hardcodes little-endian and could produce wrong pointers on big-endian targets. Switching to from_ne_bytes is a correct, low-risk fix to produce the correct pointer value across architectures.\n\n</details></details></td><td align=center>10\n\n</td></tr><tr><td rowspan=6><strong>Possible bug</strong></td>\n<td>\n\n\n\n<details><summary>The non-modal dialog can be garbage-collected after the method returns, preventing the user decision from being sent and leaving the daemon blocked<!-- not_implemented --></summary>\n\n___\n\n\n**The non-modal dialog instance is only stored in a local variable; after <br><code>handle_connection_request</code> returns there is no strong Python reference to it, so the <br><code>FirewallDialog</code> can be garbage-collected prematurely, causing the popup to disappear <br>or never receive its <code>finished</code> signal and leaving the daemon blocked waiting for a <br>response. Keep a reference on <code>self</code> for the lifetime of the dialog and clear it when <br>the dialog finishes.**\n\n[bastion-gui.py [233-269]](https://github.com/shipdocs/bastion-firewall/pull/19/files#diff-187b1e5910f096aae7417e760f849b9a564ea1ed82afd7d450e58fa8cced9a57R233-R269)\n\n```diff\n def handle_connection_request(self, req):\n     \"\"\"\n     Display a non-modal firewall decision dialog for an incoming connection request and send the user's decision back to the daemon.\n \n     Parameters:\n         req (dict): Incoming request payload used to populate the dialog. May include a numeric 'decision_id' (defaults to 0) which will be echoed back in the response.\n \n     Behavior:\n         - Shows a non-modal FirewallDialog with a 60-second timeout to obtain the user's decision and permanence choice.\n         - Dialog doesn't steal focus, allowing user to continue working.\n         - If connected to the daemon, sends a JSON line containing `allow` (boolean), `permanent` (boolean), and `decision_id` back over the socket.\n         - If sending the response fails, the client disconnects and resets its connection state.\n     \"\"\"\n     dialog = FirewallDialog(req, timeout=60)\n+    self._current_dialog = dialog  # Keep a strong reference to prevent GC\n     decision_id = req.get('decision_id', 0)\n \n     # Handle dialog completion (non-modal)\n     def on_dialog_finished():\n         decision = (dialog.decision == 'allow')\n         permanent = dialog.permanent\n \n         # Send response with decision_id\n         if self.connected and self.sock:\n             resp = json.dumps({\n                 'allow': decision,\n                 'permanent': permanent,\n                 'decision_id': decision_id\n             }) + '\\n'\n             try:\n                 self.sock.sendall(resp.encode())\n             except:\n                 self.handle_disconnect()\n \n         dialog.deleteLater()  # Clean up dialog\n+        self._current_dialog = None  # Release reference once finished\n \n     dialog.finished.connect(on_dialog_finished)\n     dialog.show()  # Non-modal - doesn't steal focus!\n \n```\n<details><summary>Suggestion importance[1-10]: 10</summary>\n\nWhy it matters? ü§î: This is a real, practical bug in PyQt/PySide-based applications: if the dialog has no QObject parent and only a local Python reference exists, the Python GC can collect it after the method returns, which may remove the underlying C++ object or stop signals from being delivered. The suggested change (keep a strong reference on self and clear it in the finished handler) directly prevents premature GC and ensures the finished signal fires and the response is sent. It's a small, targeted fix that resolves a possible race/bug introduced by making the dialog non-modal.\n\n</details></details></td><td align=center>10\n\n</td></tr><tr><td>\n\n\n\n<details><summary>The package may ship stale eBPF-related files because the target share directory is never cleaned before reuse</summary>\n\n___\n\n\n**The new directory <code>debian/usr/share/bastion-firewall</code> is created without clearing any <br>existing contents, whereas the previous v2 build script explicitly removed this <br>tree; running the new script after an older build can therefore leave stale or <br>renamed eBPF or support files in the package, which may confuse the daemon that <br>expects a single <code>bastion-ebpf.o</code>.**\n\n[build_deb.sh [42]](https://github.com/shipdocs/bastion-firewall/pull/19/files#diff-5ff8ce75532c01d42d4af24ef679dd19b1a225266046c14cd5d4493e144a30ebR42-R42)\n\n```diff\n-mkdir -p debian/usr/share/bastion-firewall\n+rm -rf debian/usr/share/bastion-firewall && mkdir -p debian/usr/share/bastion-firewall\n \n```\n<details><summary>Suggestion importance[1-10]: 10</summary>\n\nWhy it matters? ü§î: The script creates debian/usr/share/bastion-firewall but does not remove existing contents. Older builds could leave stale or renamed eBPF/support files in that directory which would then be packaged. Cleaning the dir before populating it (rm -rf && mkdir -p) is a reasonable and low-risk fix to ensure reproducible packages and avoid shipping unintended files.\n\n</details></details></td><td align=center>10\n\n</td></tr><tr><td>\n\n\n\n<details><summary>The script unconditionally edits the control file with sed even when it may not exist, causing a hard build failure despite the preceding existence check</summary>\n\n___\n\n\n**The comment claims the control file is checked before editing, but <code>sed</code> is still run <br>unconditionally on <code>debian/DEBIAN/control</code>; if that file is missing (for example in a <br>fresh packaging skeleton), the script will exit with a <code>sed: can't read</code> error despite <br>the guard, making the build fragile.**\n\n[build_deb_v2.sh [195-206]](https://github.com/shipdocs/bastion-firewall/pull/19/files#diff-3bf64863e0e24bea916400a769a41a0f2b0c7da374ae38d2ce6d89b967902d87R195-R206)\n\n```diff\n-# FIX #16: Check if control file exists before editing\n+# FIX #16: Check if control file exists before editing and updating Installed-Size\n if [ -f \"debian/DEBIAN/control\" ]; then\n     chmod 644 debian/DEBIAN/control\n+    # Calculate installed size\n+    INSTALLED_SIZE=$(du -sk debian/usr debian/lib 2>/dev/null | awk '{s+=$1} END {print s}')\n+    sed -i \"s/^Installed-Size:.*/Installed-Size: $INSTALLED_SIZE/\" debian/DEBIAN/control\n+else\n+    print_warning \"debian/DEBIAN/control not found; skipping Installed-Size update\"\n fi\n \n-# Calculate installed size\n-INSTALLED_SIZE=$(du -sk debian/usr debian/lib 2>/dev/null | awk '{s+=$1} END {print s}')\n-sed -i \"s/^Installed-Size:.*/Installed-Size: $INSTALLED_SIZE/\" debian/DEBIAN/control\n-\n```\n<details><summary>Suggestion importance[1-10]: 10</summary>\n\nWhy it matters? ü§î: The suggestion is correct: the script currently runs sed unconditionally on debian/DEBIAN/control after only conditionally chmod'ing it. If the control file is missing the sed invocation will fail and, because set -e is enabled, the whole script will exit. Wrapping the Installed-Size calculation and the sed update inside the existing file-exists branch (or guarding the sed separately) prevents a fragile hard-fail on fresh packaging skeletons. This fixes a real robustness bug rather than being mere style nit.\n\n</details></details></td><td align=center>10\n\n</td></tr><tr><td>\n\n\n\n<details><summary>Cleanup of the NFQUEUE iptables rule causes the service stop to fail when the rule is already absent<!-- not_implemented --></summary>\n\n___\n\n\n**The <code>ExecStopPost</code> iptables deletion is treated as mandatory cleanup, so if the <br>NFQUEUE rule has already been removed or was never inserted, stopping the service <br>will fail due to the non-zero exit status of iptables, even though this cleanup <br>should be best-effort and not cause the unit stop to be marked as failed.**\n\n[bastion-rs/bastion-daemon.service [11]](https://github.com/shipdocs/bastion-firewall/pull/19/files#diff-8b0db3141377c66f2eb8b3302b416dbf655072e6d90dc8657c6d2625785f5e28R11-R11)\n\n```diff\n-ExecStopPost=/usr/sbin/iptables -D OUTPUT -m state --state NEW -j NFQUEUE --queue-num 1 --queue-bypass\n+ExecStopPost=/bin/sh -c 'iptables -D OUTPUT -m state --state NEW -j NFQUEUE --queue-num 1 --queue-bypass 2>/dev/null || true'\n \n```\n<details><summary>Suggestion importance[1-10]: 10</summary>\n\nWhy it matters? ü§î: ExecStopPost runs during stop/kill handling; an iptables -D that fails returns non-zero and can mark the stop as failed. Making the deletion best-effort (redirect errors to /dev/null and || true) prevents spurious unit failures when the rule is already gone. This is a practical and appropriate fix.\n\n</details></details></td><td align=center>10\n\n</td></tr><tr><td>\n\n\n\n<details><summary>The IPv4 extraction helper performs a potentially unaligned <code>u32</code> dereference, which is undefined behavior and may fail under the eBPF verifier</summary>\n\n___\n\n\n**The <code>ipv4_from_sockaddr</code> helper casts a <code>*const u8</code> derived from a <code>[u8; 16]</code> stack buffer <br>to <code>*const u32</code> and dereferences it, which is undefined behavior in Rust because the <br>buffer has alignment 1 and thus may not satisfy the 4-byte alignment required for <br><code>u32</code>, potentially causing verifier rejection or subtle runtime misbehavior on some <br>targets; instead, load the four bytes individually (or via <code>read_unaligned</code>) and <br>reconstruct the <code>u32</code>.**\n\n[bastion-rs/ebpf/src/main.rs [52-66]](https://github.com/shipdocs/bastion-firewall/pull/19/files#diff-d989f00c672d286cc345dbbb7ede04f61840f66a577f697ff16bc5a5df47639eR52-R66)\n\n```diff\n #[inline]\n fn ipv4_from_sockaddr(addr: *const core::ffi::c_void) -> u32 {\n     // sockaddr_in structure:\n     // struct sockaddr_in {\n     //     sa_family_t    sin_family;   // AF_INET\n     //     in_port_t      sin_port;     // Port number\n     //     struct in_addr sin_addr;     // IPv4 address\n     // };\n     unsafe {\n         let addr = addr as *const u8;\n-        // Skip sin_family (2 bytes) and sin_port (2 bytes)\n-        let ip_ptr = addr.add(4) as *const u32;\n-        *ip_ptr  // Already in network byte order\n+        // Skip sin_family (2 bytes) and sin_port (2 bytes) and read 4 bytes of IP\n+        let b0 = *addr.add(4);\n+        let b1 = *addr.add(5);\n+        let b2 = *addr.add(6);\n+        let b3 = *addr.add(7);\n+        // Preserve the raw bit pattern as in the original memory\n+        u32::from_ne_bytes([b0, b1, b2, b3])\n     }\n }\n \n```\n<details><summary>Suggestion importance[1-10]: 10</summary>\n\nWhy it matters? ü§î: The suggestion correctly identifies an unaligned dereference: casting a byte pointer to *const u32 and dereferencing can be UB and is likely to be rejected by the eBPF verifier or cause issues on architectures with strict alignment. Reconstructing the 4 bytes (or using read_unaligned) avoids alignment pitfalls while preserving the original memory pattern. This fixes a real correctness/verifier risk rather than being a cosmetic change.\n\n</details></details></td><td align=center>10\n\n</td></tr><tr><td>\n\n\n\n<details><summary>The port extraction helper uses a potentially unaligned <code>u16</code> dereference, which is undefined behavior and may cause eBPF verifier or runtime issues</summary>\n\n___\n\n\n**The <code>port_from_sockaddr</code> helper similarly casts a <code>*const u8</code> derived from a <code>[u8; 16]</code> <br>stack buffer to <code>*const u16</code> and dereferences it, which is undefined behavior because <br>the buffer is only 1-byte aligned and may not meet the 2-byte alignment requirement <br>for <code>u16</code>, risking verifier rejection or subtle bugs; instead, read the two bytes and <br>reconstruct the <code>u16</code> with <code>from_be_bytes</code>.**\n\n[bastion-rs/ebpf/src/main.rs [89-97]](https://github.com/shipdocs/bastion-firewall/pull/19/files#diff-d989f00c672d286cc345dbbb7ede04f61840f66a577f697ff16bc5a5df47639eR89-R97)\n\n```diff\n #[inline]\n fn port_from_sockaddr(addr: *const core::ffi::c_void) -> u16 {\n     unsafe {\n         let addr = addr as *const u8;\n-        // Skip sin_family (2 bytes)\n-        let port_ptr = addr.add(2) as *const u16;\n-        u16::from_be(*port_ptr)  // Network byte order to host\n+        // Skip sin_family (2 bytes) and read the two port bytes\n+        let b0 = *addr.add(2);\n+        let b1 = *addr.add(3);\n+        u16::from_be_bytes([b0, b1])  // Network byte order to host\n     }\n }\n \n```\n<details><summary>Suggestion importance[1-10]: 10</summary>\n\nWhy it matters? ü§î: This is the same class of problem as the IPv4 case: casting to *const u16 and dereferencing can be unaligned UB. Reading the two bytes and using from_be_bytes (or read_unaligned) yields the correct host-order port without alignment issues and prevents verifier/runtime failures. It's a functional fix, not just style.\n\n</details></details></td><td align=center>10\n\n</td></tr><tr><td rowspan=4><strong>Security</strong></td>\n<td>\n\n\n\n<details><summary>Running the daemon as unrestricted root without capability bounding unnecessarily increases the impact of a compromise<!-- not_implemented --></summary>\n\n___\n\n\n**The daemon is run as full root without any capability bounding, whereas the existing <br>Rust service unit in this repo restricts it to only CAP_NET_ADMIN and CAP_NET_RAW; <br>dropping the bounding here means any compromise of the daemon yields unrestricted <br>root privileges instead of a minimized capability set, which is an avoidable <br>security regression.**\n\n[bastion-daemon.service [9]](https://github.com/shipdocs/bastion-firewall/pull/19/files#diff-688c0f4218bd1a9503b3d8930a05d34394e57ad608e093de7dce9d01c48f4ae4R9-R9)\n\n```diff\n User=root\n+CapabilityBoundingSet=CAP_NET_ADMIN CAP_NET_RAW\n+AmbientCapabilities=CAP_NET_ADMIN CAP_NET_RAW\n \n```\n<details><summary>Suggestion importance[1-10]: 10</summary>\n\nWhy it matters? ü§î: The unit currently runs the service as root (User=root) with no capability restrictions in the final file. For a network/eBPF daemon the attack surface is sensitive; restricting capabilities (CapabilityBoundingSet and AmbientCapabilities) to only what's required (e.g., CAP_NET_ADMIN CAP_NET_RAW) reduces blast radius if the daemon is compromised. This is a legitimate security hardening suggestion rather than a cosmetic change. It directly improves runtime safety and aligns with least-privilege practices.\n\n</details></details></td><td align=center>10\n\n</td></tr><tr><td>\n\n\n\n<details><summary>‚úÖ <s>Unvalidated config file path allows arbitrary root file overwrite when the helper is invoked via pkexec</s></summary>\n\n___\n\n<details><summary><b>Suggestion Impact:</b></summary>The commit adds a case statement that restricts CONFIG_FILE to /etc/bastion/* and exits with an error otherwise, before performing mv \"$TEMP_FILE\" \"$CONFIG_FILE\".\n\n\ncode diff:\n\n```diff\n+# Ensure the config file lives under the expected Bastion config directory\n+case \"$CONFIG_FILE\" in\n+    /etc/bastion/*) ;;\n+    *)\n+        echo \"Error: Invalid config file path: $CONFIG_FILE\" >&2\n+        exit 1\n+        ;;\n+esac\n+\n # Move the temporary file to the config location\n mv \"$TEMP_FILE\" \"$CONFIG_FILE\"\n```\n\n</details>\n\n\n___\n\n\n**The script blindly trusts the <code>CONFIG_FILE</code> argument, so when it is executed via <br><code>pkexec</code>/polkit an authorized unprivileged user can point it at any path and <br>overwrite/chmod arbitrary root-owned files, which is a privilege-escalation risk; <br>you should restrict the target path to the expected Bastion config directory before <br>moving the file.**\n\n[bastion-reload-config [27-28]](https://github.com/shipdocs/bastion-firewall/pull/19/files#diff-67e8af6fb87ff1c8e72c7e6a5dc6f9f5fb0245674bdf14947e37d9bfff8e7edcR27-R28)\n\n```diff\n+# Ensure the config file lives under the expected Bastion config directory\n+case \"$CONFIG_FILE\" in\n+    /etc/bastion/*) ;;\n+    *)\n+        echo \"Error: Invalid config file path: $CONFIG_FILE\" >&2\n+        exit 1\n+        ;;\n+esac\n+\n # Move the temporary file to the config location\n mv \"$TEMP_FILE\" \"$CONFIG_FILE\"\n \n```\n<details><summary>Suggestion importance[1-10]: 10</summary>\n\nWhy it matters? ü§î: The PR's script accepts an arbitrary CONFIG_FILE and immediately moves the temp file there as root (lines show mv \"$TEMP_FILE\" \"$CONFIG_FILE\"). If this helper is invoked via a privilege-escalation helper (pkexec/polkit) or any other mechanism that runs it as root on behalf of an unprivileged user, an attacker could point CONFIG_FILE at any root-owned file under the filesystem and overwrite it. Restricting the allowed destination (for example to /etc/bastion/*) is a real security hardening step, not mere style. The improved code properly validates the path before performing the mv, which mitigates the privilege-escalation risk.\n\n</details></details></td><td align=center>10\n\n</td></tr><tr><td>\n\n\n\n<details><summary>‚úÖ <s>Directly moving a user-controlled temp file without rejecting symlinks can expose sensitive root-owned files by moving and chmodding them to a world-readable rules path</s></summary>\n\n___\n\n<details><summary><b>Suggestion Impact:</b></summary>The commit added a symlink rejection guard (`if [ -L \"$TEMP_FILE\" ] ... exit 1`) before the `mv` operation, implementing the core security mitigation suggested.\n\n\ncode diff:\n\n```diff\n+# Reject symlinks to avoid clobbering arbitrary root-owned files\n+if [ -L \"$TEMP_FILE\" ]; then\n+    echo \"Error: Temporary file must not be a symlink: $TEMP_FILE\" >&2\n+    exit 1\n+fi\n```\n\n</details>\n\n\n___\n\n\n**Moving a user-controlled temporary file directly with <code>mv</code> and then making it <br>world-readable allows a symlink attack where an attacker replaces the temp file path <br>with a symlink to a sensitive root-owned file (e.g. <code>/etc/shadow</code>), causing that file <br>to be moved to the rules path and chmodded <code>644</code>, effectively exposing its contents; <br>you should explicitly reject symlinks before performing the move.**\n\n[bastion-reload-rules [21-31]](https://github.com/shipdocs/bastion-firewall/pull/19/files#diff-2d74c49518987e8487fe7795778d1eee184a28d5389f1c3dd2e48d798ea41af2R21-R31)\n\n```diff\n # Validate paths\n if [ ! -f \"$TEMP_FILE\" ]; then\n     echo \"Error: Temporary file does not exist: $TEMP_FILE\" >&2\n+    exit 1\n+fi\n+\n+# Reject symlinks to avoid clobbering arbitrary root-owned files\n+if [ -L \"$TEMP_FILE\" ]; then\n+    echo \"Error: Temporary file must not be a symlink: $TEMP_FILE\" >&2\n     exit 1\n fi\n \n # Move the temporary file to the rules location\n mv \"$TEMP_FILE\" \"$RULES_FILE\"\n \n # Set proper permissions (readable by all, writable by root)\n chmod 644 \"$RULES_FILE\"\n \n```\n<details><summary>Suggestion importance[1-10]: 10</summary>\n\nWhy it matters? ü§î: This is a real security issue. The script runs as root and accepts a user-controlled path; if that path is a symlink an attacker can cause mv/chmod to affect an arbitrary target (e.g. /etc/shadow). On typical Linux semantics, moving a symlink and then running chmod can end up changing the target's permissions or creating a symlink at the destination that points at a sensitive file ‚Äî both lead to information disclosure or tampering. Rejecting symlinks (or verifying ownership and using a safe install/rename pattern) fixes a genuine vulnerability rather than a cosmetic change.\n\n</details></details></td><td align=center>10\n\n</td></tr><tr><td>\n\n\n\n<details><summary>Running the daemon as root without bounding Linux capabilities gives it more kernel privileges than necessary and increases security risk</summary>\n\n___\n\n\n**The service runs a network-facing firewall daemon as root without any capability <br>bounding, whereas the existing Rust daemon unit (<code>bastion-rs/bastion-daemon.service</code>) <br>explicitly restricts it to <code>CAP_NET_ADMIN</code> and <code>CAP_NET_RAW</code>; leaving this service with <br>full capabilities unnecessarily increases the impact of any compromise of the daemon <br>process.**\n\n[bastion-firewall.service [6]](https://github.com/shipdocs/bastion-firewall/pull/19/files#diff-e7fb5e23b406b2e65df33e223870991c4323949fa38b560fa624ac74f131e4e0R6-R6)\n\n```diff\n Type=simple\n+CapabilityBoundingSet=CAP_NET_ADMIN CAP_NET_RAW\n+AmbientCapabilities=CAP_NET_ADMIN CAP_NET_RAW\n \n```\n<details><summary>Suggestion importance[1-10]: 5</summary>\n\nWhy it matters? ü§î: Limiting capabilities (CapabilityBoundingSet / AmbientCapabilities) is a valid defense-in-depth control for a network-facing root daemon that only needs NET_ADMIN/NET_RAW. The PR currently runs the process as root with no capability restrictions (User=root, Group=root present in the unit), so adding capability bounding reduces blast radius if the daemon is compromised. This is a genuine security improvement, not merely stylistic.\n\n</details></details></td><td align=center>5\n\n</td></tr><tr><td rowspan=1><strong>Resource leak</strong></td>\n<td>\n\n\n\n<details><summary>‚úÖ <s>Writing logs via systemd to a file that logrotate rotates with <code>create</code> causes logs to keep going to the rotated file and defeats rotation</s></summary>\n\n___\n\n<details><summary><b>Suggestion Impact:</b></summary>The service unit was changed from appending to /var/log/bastion-daemon.log to using journald (StandardOutput=journal and StandardError=journal), resolving the logrotate interaction issue. The commit also added capabilities settings, but the journald change directly implements the suggestion.\n\n\ncode diff:\n\n```diff\n-StandardOutput=append:/var/log/bastion-daemon.log\n-StandardError=append:/var/log/bastion-daemon.log\n+CapabilityBoundingSet=CAP_NET_ADMIN CAP_NET_RAW\n+AmbientCapabilities=CAP_NET_ADMIN CAP_NET_RAW\n+StandardOutput=journal\n+StandardError=journal\n```\n\n</details>\n\n\n___\n\n\n**Logging directly to <code>/var/log/bastion-daemon.log</code> via <code>StandardOutput=append:</code> and <br><code>StandardError=append:</code> conflicts with the existing logrotate config (which uses <br><code>create</code> and a <code>systemctl reload</code> hook): after rotation, systemd will keep writing to <br>the old, renamed file instead of the newly created one, so log rotation will not <br>actually limit log size and can lead to unbounded log growth.**\n\n[bastion-firewall.service [14-15]](https://github.com/shipdocs/bastion-firewall/pull/19/files#diff-e7fb5e23b406b2e65df33e223870991c4323949fa38b560fa624ac74f131e4e0R14-R15)\n\n```diff\n-StandardOutput=append:/var/log/bastion-daemon.log\n-StandardError=append:/var/log/bastion-daemon.log\n+StandardOutput=journal\n+StandardError=journal\n \n```\n<details><summary>Suggestion importance[1-10]: 10</summary>\n\nWhy it matters? ü§î: This is a real, practical problem: when systemd keeps a file descriptor open to a log file, logrotate's 'create' (or moving/renaming) will not make systemd switch to the new file and rotated logs will continue to grow unchecked. Switching to journald (StandardOutput=journal / StandardError=journal) fixes the rotation issue and centralizes logs in the journal. The suggestion directly addresses a resource / log-rotation bug introduced by the PR.\n\n</details></details></td><td align=center>10\n\n</td></tr></tr></tbody></table>\n\n","createdAt":"2025-12-28T20:05:25Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[{"content":"THUMBS_UP","users":{"totalCount":1}},{"content":"THUMBS_DOWN","users":{"totalCount":1}}],"url":"https://github.com/shipdocs/bastion-firewall/pull/19#issuecomment-3695009286","viewerDidAuthor":false},{"id":"IC_kwDOQsqSJc7cPV5K","author":{"login":"codeant-ai"},"authorAssociation":"NONE","body":"CodeAnt AI finished reviewing your PR.","createdAt":"2025-12-28T20:05:31Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/shipdocs/bastion-firewall/pull/19#issuecomment-3695009354","viewerDidAuthor":false}],"files":[{"path":".github-issue-popup-focus.md","additions":77,"deletions":0},{"path":".gitignore","additions":1,"deletions":0},{"path":"CLAUDE.md","additions":269,"deletions":0},{"path":"README.md","additions":53,"deletions":27},{"path":"REQUIREMENTS.md","additions":147,"deletions":0},{"path":"TESTING.md","additions":178,"deletions":0},{"path":"bastion-daemon-legacy.py","additions":0,"deletions":0},{"path":"bastion-firewall.service","additions":8,"deletions":3},{"path":"bastion-gui.py","additions":37,"deletions":14},{"path":"bastion-launch-gui.sh","additions":75,"deletions":0},{"path":"bastion-reload-config","additions":45,"deletions":0},{"path":"bastion-reload-rules","additions":42,"deletions":0},{"path":"bastion-rs/.gitignore","additions":2,"deletions":0},{"path":"bastion-rs/Cargo.lock","additions":527,"deletions":0},{"path":"bastion-rs/Cargo.toml","additions":23,"deletions":0},{"path":"bastion-rs/README.md","additions":79,"deletions":0},{"path":"bastion-rs/build_ebpf.sh","additions":57,"deletions":0},{"path":"bastion-rs/ebpf/Cargo.lock","additions":316,"deletions":0},{"path":"bastion-rs/ebpf/Cargo.toml","additions":12,"deletions":0},{"path":"bastion-rs/ebpf/src/main.rs","additions":305,"deletions":0},{"path":"bastion-rs/src/config.rs","additions":200,"deletions":0},{"path":"bastion-rs/src/ebpf_loader.rs","additions":289,"deletions":0},{"path":"bastion-rs/src/ipc.rs","additions":231,"deletions":0},{"path":"bastion-rs/src/main.rs","additions":616,"deletions":0},{"path":"bastion-rs/src/process.rs","additions":514,"deletions":0},{"path":"bastion-rs/src/rules.rs","additions":203,"deletions":0},{"path":"bastion-rs/src/whitelist.rs","additions":167,"deletions":0},{"path":"bastion-rs/start_daemon.sh","additions":28,"deletions":0},{"path":"bastion-tray.desktop","additions":6,"deletions":10},{"path":"bastion/daemon.py","additions":45,"deletions":35},{"path":"bastion/firewall_core.py","additions":2,"deletions":1},{"path":"bastion/gui_qt.py","additions":24,"deletions":25},{"path":"build_deb.sh","additions":29,"deletions":119},{"path":"build_deb_v2.sh","additions":228,"deletions":0},{"path":"debian/DEBIAN/control","additions":25,"deletions":21},{"path":"debian/DEBIAN/postinst","additions":49,"deletions":28},{"path":"debian/DEBIAN/preinst","additions":23,"deletions":56},{"path":"index.html","additions":10,"deletions":5},{"path":"install.sh","additions":28,"deletions":0},{"path":"install_rust_daemon.sh","additions":152,"deletions":0},{"path":"uninstall.sh","additions":156,"deletions":0}]}
